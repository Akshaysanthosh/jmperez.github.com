<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jose M. Perez&#39;s Blog</title>
  <subtitle>Web development, performance, and some other good practices.</subtitle>
  <link href="/feed.xml" rel="self"/>
  
  <link href="https://jmperezperez.com/"/>
  <updated>2017-06-29T13:36:31.000Z</updated>
  <id>https://jmperezperez.com/</id>
  
  <author>
    <name>Jose M. Perez</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Reading List</title>
    <link href="https://jmperezperez.com/2017-07-reading-list/"/>
    <id>https://jmperezperez.com/2017-07-reading-list/</id>
    <published>2017-06-29T11:10:00.000Z</published>
    <updated>2017-06-29T13:36:31.000Z</updated>
    
    <content type="html"><![CDATA[<p>This is a list of some posts and talks I have read and watch during the last days. I write it to keep track of interesting content for myself, but you might also find it useful.</p><a id="more"></a><h2 id="Posts"><a href="#Posts" class="headerlink" title="Posts"></a>Posts</h2><ul><li><p><a href="https://twitter.com/jonsneyers" target="_blank" rel="external">Jon Sneyers</a> from Cloudinary posted <a href="http://cloudinary.com/blog/detecting_the_psychovisual_impact_of_compression_related_artifacts_using_ssimulacra" target="_blank" rel="external">Detecting the psychovisual impact of compression related artifacts using SSIMULACRA</a>. It talks about SSIM (which <a href="/ssim-jpeg-io">I have covered in the past</a>), used to compress images based as much as possible without affecting the visual appearance (no visible artifacts). Jon describes <a href="https://github.com/cloudinary/ssimulacra" target="_blank" rel="external">Cloudinary’s SSIMULACRA</a> and benchmarks it agains the top perceptual metrics.</p></li><li><p><a href="https://hackernoon.com/tech-companies-these-are-the-perks-and-benefits-i-want-5e9788c30958" target="_blank" rel="external">Tech companies: these are the perks (and benefits) I want</a>. I agree with Tara’s points about what I find important in my job and hope more companies embrace them.</p></li></ul><h2 id="Tools"><a href="#Tools" class="headerlink" title="Tools"></a>Tools</h2><ul><li><a href="http://cloudinary.com/blog/introducing_website_speed_test_an_image_analysis_tool_integrated_with_webpagetest" target="_blank" rel="external">Cloudinary released</a> their <a href="https://webspeedtest.cloudinary.com" target="_blank" rel="external">Website Speed Test Image Analysis Tool</a>, which is also integrated with WebPagetest.</li></ul><p><img src="/assets/images/posts/website-speed-test.png" alt="Website Speed Test"></p><p><small class="caption">A screenshot of Cloudinary’s Website Speed Test checking this site.</small></p><h2 id="Talks"><a href="#Talks" class="headerlink" title="Talks"></a>Talks</h2><ul><li><a href="https://twitter.com/nicj" target="_blank" rel="external">Nic Jansma</a> and <a href="https://twitter.com/shubhie" target="_blank" rel="external">Shubhie Panicker</a> gave a talk at Fluent Conf named “Reliably Measuring Responsiveness in the Wild”. <a href="https://docs.google.com/presentation/d/15DsvKVrt9vIL5s-wH4VhCGEhS-FkjD5pP3dH1-hzPi8/edit" target="_blank" rel="external">The slides for the talk</a> are already available. They are full with great insights and are a must if you are into web performance. They show how to on measure responsiveness using old and new Browser APIs like <a href="/paint-timing-api">PerformanceObserver</a>, and show examples from real sites and how these metrics affect conversion rates.</li></ul><p><img src="/assets/images/posts/reliably-measuring-responsiveness.png" alt="Reliably measuring responsiveness"></p><p><small class="caption">One of the slides <a href="https://docs.google.com/presentation/d/15DsvKVrt9vIL5s-wH4VhCGEhS-FkjD5pP3dH1-hzPi8/edit" target="_blank" rel="external">of the talk</a> explaining how to detect long tasks on our sites.</small></p><h2 id="Conferences"><a href="#Conferences" class="headerlink" title="Conferences"></a>Conferences</h2><ul><li><p><a href="https://twitter.com/pinchito" target="_blank" rel="external">Alex Fernández</a> has published <a href="http://pinchito.es/2017/jsdayes-2017-cost.html" target="_blank" rel="external">How Much Did JSDayES 2017 Cost?</a>. This is a conference <a href="/jsdayes-madrid-2017">I attended</a> and it’s eye-opening to see how much effort is put behind the scenes.</p></li><li><p>I’m from Alicante, Spain, and I was very happy to find out about <a href="http://reactalicante.es" target="_blank" rel="external">React Alicante 2017</a>. There are not many tech conferences in the area, and I hope it is a success. Unfortunately I won’t be able to attend, but i¡ll keep a close eye on it.</p></li></ul>]]></content>
    
    <summary type="html">
    
      Reading List with some articles from June 2017
    
    </summary>
    
    
      <category term="web" scheme="https://jmperezperez.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>The (mobile) web is making a come-back</title>
    <link href="https://jmperezperez.com/web-is-back/"/>
    <id>https://jmperezperez.com/web-is-back/</id>
    <published>2017-06-29T11:10:00.000Z</published>
    <updated>2017-06-29T13:33:17.000Z</updated>
    
    <content type="html"><![CDATA[<p>The web ecosystem is maturing and every day we understand better how to architecture large and maintainable web applications. We also understand what makes our sites slower and are coming up with solutions to overcome this.</p><p>Building a complex site that can work on slow networks is a challenge. One that some companies have decided to accept without fear and share with the developer community.</p><a id="more"></a><h2 id="Western-companies-looking-at-users-from-developing-countries"><a href="#Western-companies-looking-at-users-from-developing-countries" class="headerlink" title="Western companies looking at users from developing countries"></a>Western companies looking at users from developing countries</h2><p>Instagram, Twitter, Uber, Tinder. They have in common that they are well known in the developed world, and also that they have embraced the web as the channel to reach users in emerging markets. Not as a basic site with a large modal to download the app, but with a full-feature experience. After all, web users shouldn’t be considered second-class citizens.</p><p>Twitter has been great at talking about implementation details (see <a href="https://blog.twitter.com/official/en_us/topics/product/2017/introducing-twitter-lite.html" target="_blank" rel="external">Introducing Twitter Lite</a> and <a href="https://medium.com/@paularmstrong/twitter-lite-and-high-performance-react-progressive-web-apps-at-scale-d28a00e780a3" target="_blank" rel="external">Twitter Lite and High Performance React Progressive Web Apps at Scale</a>) which is really helpful for devs like me who face some of these challenges on a daily basis. And, because anyone can see the code you ship, it’s easy to look <a href="Twitter Lite and High Performance React Progressive Web Apps at Scale">into the details</a>.</p><p><img src="/assets/images/posts/twitter-lite.png" alt="Twitter Lite&#39;s saving options"></p><p><small class="caption">Twitter Lite also offers an option to save data.</small></p><p>The case of Instagram is notable too because of its scale. They recently <a href="http://fortune.com/2017/05/09/instagram-mobile-website-upload-photos/" target="_blank" rel="external">added photo upload</a> to their mobile site in a clear sign of their investment on the platform, but haven’t shared details about how the tech behind the site. Tinder is a similar case, with <a href="http://blog.gotinder.com/introducing-tinder-online/" target="_blank" rel="external">a newer website</a>.</p><p>And a couple of days ago it was Uber with <a href="https://eng.uber.com/m-uber/" target="_blank" rel="external">Building m.uber: Engineering a high-performance web app for the global market</a>. They describe their JS stack, some interesting things they are doing to reduce the payload and also what they plan for the future.</p><p><a href="https://building.calibreapp.com/beyond-the-bubble-real-world-performance-9c991dcd5342" target="_blank" rel="external">It’s evident where the next Internet users are going to come from</a> and no big company wants to miss the opportunity.</p><h2 id="Emerging-markets-leading-PWA"><a href="#Emerging-markets-leading-PWA" class="headerlink" title="Emerging markets leading PWA"></a>Emerging markets leading PWA</h2><p>If you want to find the leading companies on web development stop looking in Silicon Valley and turn your head towards India and China. There is no talk from Google about PWA where a company from from these countries doesn’t showcase their site. <a href="http://flipkart.com" target="_blank" rel="external">Flipkart</a>, <a href="https://www.treebo.com" target="_blank" rel="external">Treebo</a>, <a href="https://housing.com" target="_blank" rel="external">Housing</a>, and <a href="https://www.ele.me" target="_blank" rel="external">ele.me</a> are some examples. Have a look at the recent <a href="https://www.youtube.com/watch?v=aCMbSyngXB4" target="_blank" rel="external">Production Progressive Web Apps With JavaScript Frameworks (Google I/O ‘17)</a>.</p><p><img src="/assets/images/posts/flipkart-pwa.png" alt="Flipkart&#39;s PWA seems to be improving important metrics"></p><p><small class="caption">Some insights from Flipkart and the impact of their mobile site.</small></p><p>Before anyone else they saw the benefits of building sites that can work offline and can work fine on a slow network without the hassle of app downloads and updates.</p><p>I believe this is good for users, but also for companies. Updating web content is almost instantaneous. This means deploying new features, but also fixing bugs. And believe me, when there is a big issue and you need to fix something right now, time is precious.</p><p>Developers can ship code without an expensive process of building whole apps and have them go through a submission/revision system. They also benefit from quicker feedback loops when coding and seeing their changes on the screen (to be fair, React Native is making this one way better in the native world).</p><h2 id="The-mobile-web-in-2017"><a href="#The-mobile-web-in-2017" class="headerlink" title="The mobile web in 2017"></a>The mobile web in 2017</h2><p>When I saw <a href="https://twitter.com/markdalgleish/status/879144162389393409" target="_blank" rel="external">this tweet</a> I laughed out loud.</p><p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Updated: The mobile web in 2017, <strong>now with web fonts!</strong><br><br>(Original: <a href="https://t.co/nLta2tqk42" target="_blank" rel="external">https://t.co/nLta2tqk42</a>) <a href="https://t.co/c4ZgEdkbU8" target="_blank" rel="external">pic.twitter.com/c4ZgEdkbU8</a></p>&mdash; Mark Dalgleish (@markdalgleish) <a href="https://twitter.com/markdalgleish/status/879144162389393409" target="_blank" rel="external">26 June 2017</a></blockquote></p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><p>A moment later I got sad since this is quite true. It seems that everyone at every company assumes that apps are more engaging and retain users better than a web experience.</p><p>This is true when:</p><ul><li>a) you haven’t made an effort in making your web better,</li><li>b) you don’t hesitate in adding 3rd party tracking code that worsens your site</li><li>c) you fill the screen with banners and modals, hiding the actual content.</li></ul><p>Have a look at <a href="https://twitter.com/sbholtrop/status/878611398527520768" target="_blank" rel="external">this tweet and its thread</a>. You’ll see screenshots that should probably remind some of your past experiences browsing the web on mobile.</p><h2 id="What-does-the-future-look-like"><a href="#What-does-the-future-look-like" class="headerlink" title="What does the future look like?"></a>What does the future look like?</h2><p>I don’t know if the importance of the mobile apps will decrease, or whether those mobile web users will eventually use apps instead of the web. Will even network speed be a problem in the future?</p><p>It’s very interesting to see these trends going back and forth. At a minimum, we should always build for our users and avoid assumptions. Not all of them use powerful MacBook Pros nor have the latest iPhone.</p><p>We are paid to face these challenges, to serve our users. Let’s prioritise that instead of developer ergonomics and everyone will benefit.</p>]]></content>
    
    <summary type="html">
    
      Some recent examples of large companies implementing Progressive Web Apps, changing their mobile strategy
    
    </summary>
    
    
      <category term="web" scheme="https://jmperezperez.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>PerformanceObserver and Paint Timing API</title>
    <link href="https://jmperezperez.com/paint-timing-api/"/>
    <id>https://jmperezperez.com/paint-timing-api/</id>
    <published>2017-06-17T07:15:00.000Z</published>
    <updated>2017-07-31T20:58:57.000Z</updated>
    
    <content type="html"><![CDATA[<p>In <a href="https://blog.chromium.org/2017/06/chrome-60-beta-paint-timing-api-css.html" target="_blank" rel="external">a recent post about Chrome 60 Beta</a>, Google announced the support of the Paint Timing API to get metrics on when your page starts rendering and when the user gets content that can be consumed (more info on the definition of the events below). Here I’m going to describe this new API a bit and show you how to use it.</p><a id="more"></a><p><img src="/assets/images/posts/paint-timing-example.png" alt="Example of Paint Timing API entries"></p><p><small class="caption">Image taken from the <a href="https://blog.chromium.org/2017/06/chrome-60-beta-paint-timing-api-css.html" target="_blank" rel="external">Chrome 60 blog post</a>, which first appeared in <a href="https://youtu.be/6Ljq-Jn-EgU" target="_blank" rel="external">“Web Performance: Leveraging the Metrics that Most Affect User Experience”</a> at Google I/O 2017</small></p><p>Up until now we have been measuring performance through other metrics, mostly using the <a href="https://developer.mozilla.org/docs/Web/API/Navigation_timing_API" target="_blank" rel="external">Navigation Timing API</a>, which is also what Google Analytics uses for their <a href="http://www.ericmobley.net/measuring-performance-google-analytics/" target="_blank" rel="external">Site Speed report</a>. Yet those metrics don’t tell us the whole picture about the rendering experience.</p><p>The <a href="https://github.com/WICG/paint-timing" target="_blank" rel="external">Paint Timing API</a> aims to improve this by exposing metrics on paint events that are grouped in two types of entries. By <a href="https://github.com/WICG/paint-timing#definition" target="_blank" rel="external">its definition</a>:</p><ul><li><code>&quot;first-paint&quot;</code> entries contain a <code>DOMHighResTimeStamp</code> reporting the time when the browser first rendered after navigation. This excludes the default background paint, but includes non-default background paint. This is the first key moment developers care about in page load – when the browser has started to render the page.</li><li><code>&quot;first-contentful-paint&quot;</code> contain a <code>DOMHighResTimestamp</code> reporting the time when the browser first rendered any text, image (including background images), non-white canvas or SVG. This includes text with pending webfonts. This is the first time users could start consuming page content.</li></ul><p>A picture is worth a thousand words, so let’s see how these entries would be reported by some real web sites: <img src="/assets/images/posts/paint-timing-filmstrip.png" alt="Filmstrip from several sites showing when Paint Timing API entries are triggered"></p><p><small class="caption">Image taken from the <a href="https://github.com/WICG/paint-timing#examples" target="_blank" rel="external">Paint timing API repo on WICG</a>.</small></p><h4 id="Hacking-on-it"><a href="#Hacking-on-it" class="headerlink" title="Hacking on it"></a>Hacking on it</h4><p>As a hack project I decided to give it a try and implement it on a web site. You have a basic example <a href="https://github.com/WICG/paint-timing#usage" target="_blank" rel="external">on the Paint timing page</a>:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> observer = <span class="keyword">new</span> PerformanceObserver(<span class="function"><span class="keyword">function</span>(<span class="params">list</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> perfEntries = list.getEntries();</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; perfEntries.length; i++) &#123;</div><div class="line">     <span class="comment">// Process entries</span></div><div class="line">     <span class="comment">// report back for analytics and monitoring</span></div><div class="line">     <span class="comment">// ...</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// register observer for long task notifications</span></div><div class="line">observer.observe(&#123;<span class="attr">entryTypes</span>: [<span class="string">"paint"</span>]&#125;);</div></pre></td></tr></table></figure><p>In practice you will probably want to report the information somewhere you can track it. If you are using Google Analytics, you can use <a href="https://developers.google.com/web/updates/2017/06/user-centric-performance-metrics#tracking_fpfcp" target="_blank" rel="external">this snippet from Google’s Developer site</a> (ES6):</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> PerformanceObserver(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</div><div class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> list.getEntries()) &#123;</div><div class="line">    <span class="comment">// `name` will be either 'first-paint' or 'first-contentful-paint'.</span></div><div class="line">    <span class="keyword">const</span> metricName = entry.name;</div><div class="line">    <span class="keyword">const</span> time = <span class="built_in">Math</span>.round(entry.startTime + entry.duration);</div><div class="line"></div><div class="line">    ga(<span class="string">'send'</span>, <span class="string">'event'</span>, &#123;</div><div class="line">      <span class="attr">eventCategory</span>: <span class="string">'Performance Metrics'</span>,</div><div class="line">      <span class="attr">eventAction</span>: metricName,</div><div class="line">      <span class="attr">eventValue</span>: time,</div><div class="line">      <span class="attr">nonInteraction</span>: <span class="literal">true</span>,</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Start observing paint entries.</span></div><div class="line">observer.observe(&#123;<span class="attr">entryTypes</span>: [<span class="string">'paint'</span>]&#125;);</div></pre></td></tr></table></figure><h4 id="Word-of-Caution"><a href="#Word-of-Caution" class="headerlink" title="Word of Caution"></a>Word of Caution</h4><p>The API is still experimental and <a href="https://developer.mozilla.org/en-US/docs/Web/API/PerformanceObserver" target="_blank" rel="external">in “Editor’s Draft” state</a>. Also, the fact that a browser supports PerformanceObserver doesn’t mean that it supports the Paint events.</p><p>In the quick test I run, the above snippet would throw an exception:</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Uncaught TypeError: Failed to execute ‘observe’ on</div><div class="line">‘PerformanceObserver’: A Performance Observer MUST</div><div class="line">have at least one valid entryType in its entryTypes</div><div class="line">attribute.</div></pre></td></tr></table></figure><p>It turns out that if you only observe the <code>paint</code> entryType and this is not supported in the browser, <strong>it will throw an exception</strong>. According to <a href="https://w3c.github.io/performance-timeline/#dom-performanceobserverinit-entrytypes" target="_blank" rel="external">the specification</a>:</p><blockquote><p><code>entryTypes</code>: A list of entry names to be observed. The list must not be empty and types not recognized by the user agent must be ignored.</p></blockquote><p>In short, if you are giving this API a try, make sure you <code>try...catch</code> the <code>observer.observe()</code> call.</p><h4 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h4><p>This is a bit in early stages but I’m looking forward to see how the API evolves and we can use it to track Web Performance even better. This will also be a great addition to <a href="https://developes.google.com/web/tools/lighthouse/" target="_blank" rel="external">LightHouse</a>, <a href="http://www.webpagetest.org" target="_blank" rel="external">WebPageTest</a>, <a href="https://calibreapp.com" target="_blank" rel="external">Calibre</a> and the rest of tools we use to monitor metrics on our sites.</p>]]></content>
    
    <summary type="html">
    
      A quick look at the Paint Timing API to get metrics about render events on our pages.
    
    </summary>
    
    
      <category term="performance" scheme="https://jmperezperez.com/tags/performance/"/>
    
  </entry>
  
  <entry>
    <title>Speaking at JSDayES 2017</title>
    <link href="https://jmperezperez.com/jsdayes-madrid-2017/"/>
    <id>https://jmperezperez.com/jsdayes-madrid-2017/</id>
    <published>2017-05-14T10:50:00.000Z</published>
    <updated>2017-07-09T04:37:36.000Z</updated>
    
    <content type="html"><![CDATA[<p>I just attended <a href="http://2017.jsday.es" target="_blank" rel="external">JSDayES 2017</a> in Madrid, where I gave my talk about images and web performance. It feels great to be back to the same venue where <a href="/spain-js-2013">I gave my first talk 4 years ago in SpainJS</a> with <a href="https://twitter.com/tomasperezv" target="_blank" rel="external">Tomás Pérez</a>, who also made it to the event.</p><p>I have caught up with lots of colleagues I used to work with in Tuenti, and lots of JS devs from the Spanish community. There is a lot going on in Madrid and the rest of Spain, with very interesting companies building awesome products.</p><a id="more"></a><p>There were 500+ attendees and the event had 3 tracks with 26 talks, shorter and longer ones, and workshops. It was difficult to attend the talks and workshops I wanted to, not only because of time constraints but also space. I’m looking forward to watching some of the talks on video when they upload the recordings, and update this post with the ones I find most interesting.</p><p>The event showcased the local talent, with a track dedicated to “rising stars” for speakers with less experience, which I think was a great idea. There was an international one with English-speaking talks, and finally the main track with some talks in English, some others in Spanish.</p><p><a href="/assets/images/posts/jsdayes-2017-pinchito-substack.jpg"><img src="/assets/images/posts/jsdayes-2017-pinchito-substack.jpg" alt="The Render Conf 2017 sign by the entrance of King&#39;s Centre"></a> ^ <em>Alex (<a href="https://twitter.com/pinchito" target="_blank" rel="external">@pinchito</a>) introducing James Halliday’s (<a href="https://twitter.com/substack" target="_blank" rel="external">@substack</a>) talk.</em></p><p>This is the third edition of the event, which is consolidating as the main Javascript conference in Spain.</p><p>Being a Spaniard myself it was fine, but I would like to see even more talks in English, making the event more internationally renowned. This would not only help the event, but also the speakers which could have a higher impact by making their talks more accessible to the rest of the world.</p><p><a href="/assets/images/posts/jsdayes-2017-sign.jpg"><img src="/assets/images/posts/jsdayes-2017-sign.jpg" alt="The JSDayES 2017 sign by the entrance of the venue"></a></p><h2 id="My-talk-about-“Progressive-Image-Rendering”"><a href="#My-talk-about-“Progressive-Image-Rendering”" class="headerlink" title="My talk about “Progressive Image Rendering”"></a>My talk about “Progressive Image Rendering”</h2><div class="videoWrapper"><iframe src="https://player.vimeo.com/video/220960739?byline=0&portrait=0" width="684" height="385" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div><p>This talk is similar to the one I gave at <a href="/cssconf-au-2016">CSSConf AU</a> and <a href="/render-conf-oxford-2017">RenderConf Oxford</a>. I decided to give <a href="https://slides.com/" target="_blank" rel="external">slides.com</a> a try and moved my presentation to their platform.</p><p>I also made some changes in the content. I tried to focus more on user’s perceived performance and remove other parts to not make it that heavy. I also revisited the examples and used JSDayES’s site to illustrate a few of those.</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Great talk by <a href="https://twitter.com/jmperezperez" target="_blank" rel="external">@jmperezperez</a> about image loading process in a <a href="https://twitter.com/hashtag/Website?src=hash" target="_blank" rel="external">#Website</a> | let&#39;s have fun trying different type of loading! Seen at <a href="https://twitter.com/hashtag/JsDayEs?src=hash" target="_blank" rel="external">#JsDayEs</a> <a href="https://t.co/jgNJpzFB6n" target="_blank" rel="external">pic.twitter.com/jgNJpzFB6n</a></p>&mdash; Belen Moreno (@belenxi) <a href="https://twitter.com/belenxi/status/863380478132461569" target="_blank" rel="external">13 May 2017</a></blockquote><p>I think it went pretty well and got positive feedback both <a href="http://2017.jsday.es/#5740078466859008/99974003" target="_blank" rel="external">online</a> and there in person.</p><h3 id="Slides"><a href="#Slides" class="headerlink" title="Slides"></a>Slides</h3><p>The slides are available on <a href="https://slides.com/jmperez/pir" target="_blank" rel="external">slides.com/jmperez/pir</a> and you can also see it right here embedded:</p><div class="videoWrapper"><iframe src="//slides.com/jmperez/pir/embed" width="576" height="420" scrolling="no" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>]]></content>
    
    <summary type="html">
    
      I spoke at JSDayES 2017 in Madrid about web performance and images.
    
    </summary>
    
    
      <category term="images" scheme="https://jmperezperez.com/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>Playing with the Spotify Connect API</title>
    <link href="https://jmperezperez.com/spotify-connect-api/"/>
    <id>https://jmperezperez.com/spotify-connect-api/</id>
    <published>2017-04-21T20:10:00.000Z</published>
    <updated>2017-04-21T22:08:41.000Z</updated>
    
    <content type="html"><![CDATA[<p>Spotify <a href="https://developer.spotify.com/news-stories/2017/04/10/new-endpoints-beta-web-api-connect/" target="_blank" rel="external">released recently a set of endpoints</a> in beta to fetch information of what is playing and send playback commands. This allows for a wide range of integrations and I wanted to hack a bit with it.</p><p><img src="/assets/images/posts/spotify-connect.jpg" alt="Spotify Connect"></p><a id="more"></a><h4 id="What-is-Spotify-Connect"><a href="#What-is-Spotify-Connect" class="headerlink" title="What is Spotify Connect"></a>What is Spotify Connect</h4><p><a href="https://www.spotify.com/connect/" target="_blank" rel="external">Spotify Connect</a> is a way to transmit the playback from one device to another one without having to use a physical connection like a cable or bluetooth. You can send the music from your Spotify desktop client to a speaker, from the Spotify app on mobile to Spotify for PlayStation, from the Spotify web player to Chromecast… In short, you have controllers and devices that can play music.</p><p><img src="/assets/images/posts/spotify-web-player.png" alt="Spotify Web Player"> <small class="caption">Spotify’s Web Player (zoomed in). Clicking on the icon next to the volume we get a list of connected devices (FireTV, desktop client, speakers and the web player).</small></p><p>Your application can become a controller through the Web API endpoints, getting information about what is playing currently and from where, being able to transmit the playback to another connected device or interact with the current context (pausing, changing the volume, skipping, playing something else…).</p><h4 id="How-to-use-the-endpoints"><a href="#How-to-use-the-endpoints" class="headerlink" title="How to use the endpoints"></a>How to use the endpoints</h4><p>Before using the Connect endpoints we need to obtain an access token on behalf of the user with certain permissions. There is more information about what scopes are needed in the documentation for each endpoint.</p><p>You don’t need to have a premium account to get the playback status, a free account is alright. You will do need a premium one if you want to <a href="https://developer.spotify.com/web-api/working-with-connect/#premium-only" target="_blank" rel="external">send commands to change the playback</a>.</p><p>A caveat at the moment is that the endpoints don’t support any kind of web socket connection nor long polling. Thus, if you want to get updates on the position of the current playing track or any other change in the context, you need to poll every few seconds.</p><h4 id="A-small-library-to-make-it-easier-to-use-the-endpoints"><a href="#A-small-library-to-make-it-easier-to-use-the-endpoints" class="headerlink" title="A small library to make it easier to use the endpoints"></a>A small library to make it easier to use the endpoints</h4><p>The trickiest part of using the Spotify Web API is to implement the authorization flow. <a href="https://developer.spotify.com/web-api/authorization-guide/" target="_blank" rel="external">The Authorization Guide</a> does a good job explaining it, but I thought I could do something so developers wouldn’t need to worry about setting up the whole flow, hiding away the authentication and just getting.</p><p>That’s why I have created <a href="https://github.com/JMPerez/spotify-player" target="_blank" rel="external">spotify-player</a>. It’s both a server and a library that you use to communicate with it. To use it, you just need to include a script, call login() and subscribe to the updates:</p><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://spotify-player.herokuapp.com/spotify-player.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> spotifyPlayer = <span class="keyword">new</span> SpotifyPlayer();</div><div class="line"></div><div class="line">spotifyPlayer.on(<span class="string">'update'</span>, response =&gt; &#123;</div><div class="line">  <span class="comment">// render the track received</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line">spotifyPlayer.on(<span class="string">'login'</span>, user =&gt; &#123;</div><div class="line">  <span class="keyword">if</span> (user === <span class="literal">null</span>) &#123;</div><div class="line">    <span class="comment">// no user</span></div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// say hello to the user, and tell them to play something!</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">spotifyPlayer.init();</div><div class="line"></div><div class="line">spotifyPlayer.login();</div></pre></td></tr></table></figure><p>You can forget about <a href="https://developer.spotify.com/my-applications" target="_blank" rel="external">setting up a Spotify application</a> and a server, carrying out the token exchange, token refresh, and persisting the current user, <strong>so you can focus on the fun part</strong>.</p><p>Other methods include a function to make calls to other Spotify endpoints reusing the same access token, so you can fetch other data that can help you creating a more complete visualisation.</p><p>Let’s have a look at <a href="https://codepen.io/jmperez/full/MmwObE" target="_blank" rel="external">this pen</a> as an example of a basic visualisation:</p><p></p><p data-height="389" data-theme-id="0" data-slug-hash="MmwObE" data-default-tab="result" data-user="jmperez" data-embed-version="2" data-pen-title="Spotify - Now Playing Visualisation" class="codepen"></p><script async src="https://production-assets.codepen.io/assets/embed/ei.js"></script><p>And in case you can’t try it or don’t have a Spotify account this is pretty much what it looks like:</p><p><img src="/assets/images/posts/spotify-connect-api-visualisation-example.jpg" alt="Example of a visualisation of Spotify"> <small class="caption">See <a href="https://codepen.io/jmperez/full/MmwObE" target="_blank" rel="external">the Pen on Codepen</a></small></p><p>I have kept the example very basic since the point is understanding the usage of the library. If you are into performance and UX you’ll see there is room for improvement, but as a front-end developer I know an example can get out of hand very easily when adding things.</p><p>I encourage you to fork it and start making your own visualisation. And once you do it, ping me so I include it in <a href="https://codepen.io/collection/AyVBYB" target="_blank" rel="external">this Codepen collection</a>.</p><h3 id="Possible-applications"><a href="#Possible-applications" class="headerlink" title="Possible applications"></a>Possible applications</h3><p><em>Disclaimer: This is a list of some use cases. You still need to comply with <a href="https://developer.spotify.com/developer-terms-of-use/" target="_blank" rel="external">Spotify’s terms of use</a> when implementing an application that uses Spotify’sWeb API. This might mean adding certain messaging and link to the song in Spotify.</em></p><h4 id="Dynamic-visualisations"><a href="#Dynamic-visualisations" class="headerlink" title="Dynamic visualisations"></a>Dynamic visualisations</h4><p>You could combine the playback position with <a href="https://developer.spotify.com/web-api/get-audio-analysis/" target="_blank" rel="external">the audio analysis of the track</a> to generate dynamic visualisations using loudness, tempo, key, timbre or pitch of the segments that compose the track. You can also use <a href="https://developer.spotify.com/web-api/get-audio-features/" target="_blank" rel="external">the endpoint to fetch audio features of a track</a>, which gives you high level information about characteristics of the song.</p><div class="videoWrapper"><iframe width="720" height="405" src="https://www.youtube.com/embed/KO9huh-Y03g" frameborder="0" allowfullscreen></iframe></div><p><small class="caption">See <a href="https://codepen.io/jmperez/full/GmJOMJ" target="_blank" rel="external">the Pen on Codepen</a> and <a href="https://github.com/possan/webgl-spotify-connect-now-playing-screen-example" target="_blank" rel="external">Possan’s original visualisation on GitHub</a></small></p><h4 id="Now-playing-view"><a href="#Now-playing-view" class="headerlink" title="Now playing view"></a>Now playing view</h4><p>Are you a coffee-shop owner and people always wonder what song is playing? You could have a TV showing a branded now playing view. You could even have a widget on your website, or a script posting to a social network what is currently playing so your customers know. Or a small browser extension showing what is playing and/or <a href="https://developer.chrome.com/extensions/notifications" target="_blank" rel="external">showing desktop notifications</a> when the track changes.</p><p><img src="/assets/images/posts/spotify-connect-api-visualisation-notification.jpg" alt="Spotify Visualisation showing Web Notifications when the track changes"> <small class="caption">See <a href="https://codepen.io/jmperez/full/VbvPbR" target="_blank" rel="external">the Pen on Codepen</a>. When the track changes the browser shows a Web Notification.</small></p><p>Or if you are at home hosting a dinner or party, show on the TV or computer what is playing.</p><p>You can combine other Spotify Web API endpoints too. Eg you could <a href="https://developer.spotify.com/web-api/get-artist/" target="_blank" rel="external">fetch the artists info</a> to show the artist profile image in the background:</p><p><img src="/assets/images/posts/spotify-connect-api-visualisation-artist.jpg" alt="Spotify Visualisation showing Web Notifications when the track changes"> <small class="caption">See <a href="https://codepen.io/jmperez/full/YVXEaz" target="_blank" rel="external">the Pen on Codepen</a>. A simple visualisation of what’s playing in Spotify rendering the artist profile image as the background.</small></p><p>You could use an API like <a href="https://developer.musixmatch.com/" target="_blank" rel="external">Musixmatch</a>’s and create an app or a website showing the lyrics for the current song, synchronised with the playback position.</p><p>And your imagination is the limit. Use <a href="https://genius.com/developers" target="_blank" rel="external">Genius’ API</a> to get <a href="https://docs.genius.com/#annotations-h2" target="_blank" rel="external">annotations</a> about a song, or search for trivia and more info about the song or artist using <a href="https://www.mediawiki.org/wiki/API:Main_page" target="_blank" rel="external">Wikipedia’s API</a>. And if you don’t want to miss what’s happening in the world, implement a news ticker in your view using <a href="https://newsapi.org/" target="_blank" rel="external">News API</a>.</p><div class="videoWrapper"><iframe width="720" height="405" src="https://www.youtube.com/embed/q4I3ymLgewE" frameborder="0" allowfullscreen></iframe></div><p><small class="caption">See <a href="https://codepen.io/jmperez/full/OmVKOO" target="_blank" rel="external">the Pen on Codepen</a><small class="caption"></small></small></p><h4 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h4><p><a href="https://github.com/JMPerez/spotify-player" target="_blank" rel="external">The library</a> is really small and it only supports <em>reading</em> the playback state and not send commands. Let’s call it an MVP. I might work on adding more features in the future.</p>]]></content>
    
    <summary type="html">
    
      The new Web API endpoints let you show what is playing in your Spotify account. It is easy to create views that update in real time.
    
    </summary>
    
    
      <category term="api" scheme="https://jmperezperez.com/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>Speaking at Render Oxford 2017</title>
    <link href="https://jmperezperez.com/render-conf-oxford-2017/"/>
    <id>https://jmperezperez.com/render-conf-oxford-2017/</id>
    <published>2017-03-31T17:00:00.000Z</published>
    <updated>2017-04-13T16:16:28.000Z</updated>
    
    <content type="html"><![CDATA[<p>I just attended <a href="http://www.render-conf.com" target="_blank" rel="external">Render 2017</a>, where I gave a talk about images and web performance. It’s my first time in Oxford and I was impressed by its beauty. The organisation was great and I had a lot of fun.</p><p><a href="/assets/images/posts/render-conf-2017-sign.jpg"><img src="/assets/images/posts/render-conf-2017-sign.jpg" alt="The Render Conf 2017 sign by the entrance of King&#39;s Centre"></a></p><a id="more"></a><p>This is the second time they organise Render Conf, which commenced as the evolution of jQuery UK. The venue was next to the Thames river, with a very spacious room for the talks, another large room for sponsors and meals, and a third room for speakers.</p><p>I have only talked in two other occasions and this is the first time I get to enjoy a speakers room. It really helps calming the nerves, focusing, and making those last minute fixes to the slides. And there are always nice words when a speaker finishes their talk and need these positive messages the most.</p><h2 id="My-talk-about-“Progressive-Image-Rendering”"><a href="#My-talk-about-“Progressive-Image-Rendering”" class="headerlink" title="My talk about “Progressive Image Rendering”"></a>My talk about “Progressive Image Rendering”</h2><p>This talk is similar to the one I gave at <a href="/cssconf-au-2016">CSSConf AU</a>. This time I wasn’t able to make many changes, and I just updated a couple of things and double checked the browser support for IntersectionObserver.</p><div class="videoWrapper"><iframe width="720" height="405" src="https://www.youtube.com/embed/S70xyRYCNdY?list=PLBzScQzZ83I_n5kvxmUaRNZvc_vsCuEQD" frameborder="0" allowfullscreen></iframe></div><p>I felt less nervous than at CSSConf, and everything went well except for some minor tech issues (completely my fault) and things I wanted to mention but forgot to.</p><p><a href="https://twitter.com/malweene" target="_blank" rel="external">Malwine</a>‘s drawing summarises the talk very well:</p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Progressive Image Rendering by <a href="https://twitter.com/jmperezperez" target="_blank" rel="external">@jmperezperez</a> at <a href="https://twitter.com/hashtag/RenderConf?src=hash" target="_blank" rel="external">#RenderConf</a> <a href="https://t.co/B3cOEyi3VI" target="_blank" rel="external">pic.twitter.com/B3cOEyi3VI</a></p>&mdash; Malwine (@malweene) <a href="https://twitter.com/malweene/status/847487007018418176" target="_blank" rel="external">30 March 2017</a></blockquote><p>After the talk I had some nice conversations with some attendees both in person and on Twitter who were trying to implement lazy-loading or were interested in web performance.</p><h3 id="Slides"><a href="#Slides" class="headerlink" title="Slides"></a>Slides</h3><p>The slides are available on <a href="https://jmperezperez.com/renderconf17/">jmperezperez.com/renderconf17</a> and contain some animations and videos. A <em>static</em> version <a href="https://speakerdeck.com/jmperez/progressive-image-rendering-1" target="_blank" rel="external">is available on SpeakerDeck</a>.</p><div class="videoWrapper"><iframe width="560" height="315" src="https://speakerdeck.com/player/90be5b09730b45618fe43359ee2877ba"></iframe></div><h2 id="Some-personal-reflections"><a href="#Some-personal-reflections" class="headerlink" title="Some personal reflections"></a>Some personal reflections</h2><p>When I attend a conference I usually have a hard time breaking the ice and talking with other people, but when you are the speaker it makes lot easier since people recognises you and approach. And the dinner prior to the conference is a very good opportunity to know about the other speakers, their projects, experience, tips… In short, attending a speaker makes me enjoy the conference a lot more.</p><p>Moreover, this time I managed to meet some devs I have been following on Twitter and reading their blog posts for a long time.</p><ul><li><a href="https://adactio.com/" target="_blank" rel="external">Jeremy Keith</a>, whose <a href="https://resilientwebdesign.com/" target="_blank" rel="external">Resilient Web Design</a> I read recently and included in <a href="/2017-01-reading-list">my reading list post</a>.</li><li><a href="http://www.p01.org/" target="_blank" rel="external">Mathieu Henry aka @p01</a> who did an AWESOME live-coding visualisation using the Audio API and canvas.</li></ul><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Pretty sure that <a href="https://twitter.com/p01" target="_blank" rel="external">@p01</a> had hypnotised the whole <a href="https://twitter.com/render_conf" target="_blank" rel="external">@render_conf</a> audience with that live code art! <a href="https://twitter.com/hashtag/RenderConf?src=hash" target="_blank" rel="external">#RenderConf</a> <a href="https://t.co/rRfU6nGs59" target="_blank" rel="external">pic.twitter.com/rRfU6nGs59</a></p>&mdash; Ben Seymour (@bseymour) <a href="https://twitter.com/bseymour/status/847470593171636227" target="_blank" rel="external">30 March 2017</a></blockquote><ul><li><a href="https://andydavies.me/" target="_blank" rel="external">Andy Davies</a>, who knows a ton about Webpagetest and how to make sites fast. He gave a workshop the day before the conference about web performance.</li><li><a href="https://www.clicktorelease.com/" target="_blank" rel="external">Jaume Sanchez aka @thespite</a> who builds crazy visualisations (<a href="https://www.clicktorelease.com/code/polygon-shredder/" target="_blank" rel="external">example</a>) and redesigned his site recently and used <a href="/more-progressive-image-loading#Clicktorelease">a creative technique to load images</a>.</li><li><a href="https://rachelandrew.co.uk/" target="_blank" rel="external">Rachel Andrew</a>, from whom I first knew about the CSS Grid specification when I attended <a href="/fronteers-2015">Fronteers 2015</a>. Her talk at Render was the first one after all major browsers finally supported CSS Grids, so it was an interesting way to close the circle.</li><li>And the rest of speakers from which I learned some devtools tricks, convolutional neural networks and how web sites don’t only run on browsers anymore.</li></ul><p><a href="/assets/images/posts/render-conf-jaume-elias.jpg"><img src="/assets/images/posts/render-conf-jaume-elias.jpg" alt="Jaume Elias (thespite) talking about Virtual Reality on the Web at Render Conf"></a> ^ <em>Jaume Elias talking about Virtual Reality on the Web at Render Conf</em></p><p>It’s been a great honour sharing stage with such a great line-up. I felt like I was doing the opening act’s performance at a concert by your favourite band.</p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>]]></content>
    
    <summary type="html">
    
      I spoke at Render Conf 2017 in Oxford about web performance and images.
    
    </summary>
    
    
      <category term="images" scheme="https://jmperezperez.com/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>More examples of Progressive Image Loading</title>
    <link href="https://jmperezperez.com/more-progressive-image-loading/"/>
    <id>https://jmperezperez.com/more-progressive-image-loading/</id>
    <published>2017-03-05T17:45:00.000Z</published>
    <updated>2017-03-22T06:52:40.000Z</updated>
    
    <content type="html"><![CDATA[<p>In <a href="/medium-image-progressive-loading-placeholder">a past post</a> I dissected a technique used by Medium to display images, transitioning from a blurry image to the final one. Since then I have found some more sites following a similar approach. Let’s see how Quora, Quartz and Clicktorelease do it.</p><a id="more"></a><h2 id="Quick-Introduction"><a href="#Quick-Introduction" class="headerlink" title="Quick Introduction"></a>Quick Introduction</h2><p>Images are the largest assets on web pages and they account for two thirds of the bytes. Image optimisation and choosing the right image format is paramount. In addition, some sites are also using small thumbnails as placeholders while the final image hasn’t loaded yet. This technique is also called <em>“<a href="https://css-tricks.com/the-blur-up-technique-for-loading-background-images/" target="_blank" rel="external">blur-up</a>“</em>. It basically tries to improve user’s perceived performance while also saving data traffic when combined with lazy-loading.</p><p>There are other alternatives to this approach. One of them consists of using a single JPEG image, tweaking its scan script to quickly render an initial pixelated version of the image and progressively load the final image in several scans. I recommend you having a look at <a href="http://cloudinary.com/blog/progressive_jpegs_and_green_martians" target="_blank" rel="external">Progressive JPEGs and green Martians</a> to know more about this.</p><p>Also, if you like images optimisation, follow <a href="http://cloudinary.com/blog" target="_blank" rel="external">Cloudinary’s Blog</a>, full with useful posts on this topic.</p><h3 id="Quartz"><a href="#Quartz" class="headerlink" title="Quartz"></a>Quartz</h3><p>Take a look at the following video, recorded when accessing <a href="https://qz.com/894001/theres-a-wrong-and-a-right-way-to-talk-to-your-dog-according-to-science/" target="_blank" rel="external">a page on QZ.com</a> with a throttled connection:</p><figure class="videoWrapper"><iframe src="https://www.youtube.com/embed/Cbz3V4FGCE4" allowfullscreen width="720" height="393" frameborder="0"></iframe></figure><p>Quartz’s implementation follows this steps:</p><ol><li>Request a small <code>&lt;img/&gt;</code> that will be blurred. In their case, they use 50px width images, with a 80% quality.</li><li>Apply blur effect using a CSS filter.</li><li>Request the large image.</li></ol><p>One of the interesting points about Quartz is that their markup specifies the large image using the syntax for responsive images. The main difference is that they use a <code>data-srcset</code> attribute, so they control when to make the request and prevent the browser from requesting the large version of the image when the markup is parsed.</p><p>I find this approach very neat since they try to follow the “standard” way to serve images, adding extra bits to lazy load and animate the transition.</p><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">figure</span> <span class="attr">class</span>=<span class="string">"progressive-image featured-image size-extra-large"</span>&gt;</span></div><div class="line">  <span class="comment">&lt;!-- a picture element with intrinsic ratio --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">picture</span> <span class="attr">style</span>=<span class="string">"padding-bottom: 56.1875%; background-image: url(https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=50);"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- the small image that will be blurred --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=50"</span> <span class="attr">class</span>=<span class="string">"progressive-image-thumbnail"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- a lazy responsive image with data-srcset --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span></span></div><div class="line">      <span class="attr">itemprop</span>=<span class="string">"image"</span></div><div class="line">      <span class="attr">data-srcset</span>=<span class="string">"https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=320 320w, https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=640 640w, https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=940 940w, https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=1600 1600w, https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=3200 3200w"</span></div><div class="line">      <span class="attr">data-src</span>=<span class="string">"https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=320"</span></div><div class="line">      <span class="attr">class</span>=<span class="string">"progressive-image-large"</span> <span class="attr">alt</span>=<span class="string">"INDIA-fishermen"</span>/&gt;</div><div class="line">    <span class="comment">&lt;!-- a noscript fallback --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">noscript</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">img</span></span></div><div class="line">        <span class="attr">src</span>=<span class="string">"https://qzprod.files.wordpress.com/2017/01/fish.jpg?quality=80&amp;strip=all&amp;w=320"</span></div><div class="line">        <span class="attr">alt</span>=<span class="string">"INDIA-fishermen"</span>&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">picture</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">figcaption</span>&gt;</span>...<span class="tag">&lt;/<span class="name">figcaption</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">figure</span>&gt;</span></div></pre></td></tr></table></figure><h3 id="Quora"><a href="#Quora" class="headerlink" title="Quora"></a>Quora</h3><p>Quora also implements a blur-up technique for the images in their posts. To see an example <a href="https://www.quora.com/How-does-Quora-pre-load-images" target="_blank" rel="external">head to this page</a>.</p><p>Here we see what the page looks like when displaying the blurry placeholder:</p><p><a href="/assets/images/posts/quora-progressive-image-loading.png"><img src="/assets/images/posts/quora-progressive-image-loading.png" alt="Screenshot from Quora showing the blurry placeholder"></a></p><p>Let’s dive into the code to see what’s going on. First of all, let’s focus on the HTML markup:</p><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"qtext_image_wrapper"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- a canvas with a data-uri containing the thumbnail --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- which is in PNG format and very small (in this page 6x10 px) --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">class</span>=<span class="string">"qtext_image_placeholder portrait qtext_image zoomable_in zoomable_in_feed"</span></span></div><div class="line">        <span class="attr">width</span>=<span class="string">"499"</span></div><div class="line">        <span class="attr">height</span>=<span class="string">"874"</span></div><div class="line">        <span class="attr">data-src</span>=<span class="string">"data:image/PNG;base64,UklGRmgAAABXRUJQVlA4IFwAAADwAQCdASoGAAoAAUAmJYgCdEf/g…iD0z/yA/5ipcuk5xHSdrS38j8CkH7s+vKeZu9EwRy0f/KPIlo/+UifdfcpiRcJiRnXXAAAAA=="</span>&gt;</div><div class="line">    <span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- a lazy image with src set as data-src and master_src --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- data-src is a webp image (at least when requested using Chrome). --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- the size for data-src in this page is ~34kB --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- master_src is a png image. Its size in this page is ~177kB --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"portrait qtext_image zoomable_in zoomable_in_feed lazy_loaded lazy_loading"</span></span></div><div class="line">        <span class="attr">src</span>=<span class="string">""</span></div><div class="line">        <span class="attr">data-src</span>=<span class="string">"https://qph.ec.quoracdn.net/main-qimg-f35a9a38e575bfbe76806b7838eba025-p"</span></div><div class="line">        <span class="attr">master_src</span>=<span class="string">"https://qph.ec.quoracdn.net/main-qimg-f35a9a38e575bfbe76806b7838eba025"</span></div><div class="line">        <span class="attr">master_w</span>=<span class="string">"499"</span></div><div class="line">        <span class="attr">master_h</span>=<span class="string">"874"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p>Why to use both <code>data-src</code> and <code>master-src</code>? The <code>master_src</code> image is the one requested when clicking on the image to get a larger view.</p><p>In Quora there is no blur effect applied. They use <a href="https://developer.mozilla.org/en/docs/Web/API/CanvasRenderingContext2D/drawImage" target="_blank" rel="external"><code>canvas.drawImage()</code></a> to render the tiny thumbnail in the canvas. You can see this by inspecting their code, that lives in the <code>shared/lazy_load_images</code> module that gets bundled in the main JS file:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// draw the data-uri image on the canvas</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (e.getAttribute(<span class="string">"data-src"</span>)) &#123;</div><div class="line">        <span class="keyword">var</span> t = <span class="keyword">new</span> Image;</div><div class="line">        t.src = e.getAttribute(<span class="string">"data-src"</span>);</div><div class="line">        <span class="keyword">var</span> i = e.getAttribute(<span class="string">"width"</span>)</div><div class="line">          , n = e.getAttribute(<span class="string">"height"</span>)</div><div class="line">          , o = e.getContext(<span class="string">"2d"</span>);</div><div class="line">        t.addEventListener(<span class="string">"load"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            o.drawImage(t, <span class="number">0</span>, <span class="number">0</span>, i, n)</div><div class="line">        &#125;, <span class="literal">false</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// go through all canvas on the page with a data-src</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">r</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> e = <span class="built_in">document</span>.querySelectorAll(<span class="string">"canvas[data-src]"</span>);</div><div class="line">    d.insertionQ(<span class="string">"canvas[data-src]"</span>).every(<span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">        a(e)</div><div class="line">    &#125;),</div><div class="line">    [].forEach.call(e, a)</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>In short, Quora’s technique consists of:</p><ol><li>Draw an inlined tiny PNG in a canvas</li><li>Request the large image using WebP (if supported) or other format.</li><li>Set the large image as source for the <code>&lt;img/&gt;</code> element, animate its opacity and hide the canvas.</li></ol><h3 id="Clicktorelease"><a href="#Clicktorelease" class="headerlink" title="Clicktorelease"></a>Clicktorelease</h3><p><a href="https://www.clicktorelease.com/" target="_blank" rel="external">Clicktorelease.com</a>, <a href="https://twitter.com/thespite" target="_blank" rel="external">@thespite</a>’s website, has just been redesigned and he has also added lazy-loading of images.</p><video width="1616" height="1204" controls><source src="/assets/images/posts/clicktorelease.webm" type="video/webm"><source src="/assets/images/posts/clicktorelease.mp4" type="video/mp4"></video><p>The most interesting bit here is that the thumbnail is not the image itself, but the values <a href="https://twitter.com/thespite/status/827110706642305024" target="_blank" rel="external">of the DCT matrix for the thumbnail</a>, which makes the payload really small.</p><p>These are the steps to load an image:</p><ol><li>Make a request for the <code>thumb-src</code> image. It is a 16x4 PNG thumbnail whose size is usually in the 300B.</li><li>Create a <code>&lt;canvas/&gt;</code> and draw the image resulting from the calculation the inverse DCT of the thumbnail.</li><li>Request the large image using the <code>original-src</code> url. If the browser supports the webp image format, then “.webp” is appended to the src and a webp image is requested.</li></ol><p>The initial markup looks like this:</p><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"hero image"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- the lazy loaded image --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- thumb-src is a matrix of DCT coefficients --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- note that a background-color is also set so --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- it is rendered while the image is fetched --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">thumb-lazy</span></span></div><div class="line">      <span class="attr">original-src</span>=<span class="string">"/images/graphical-web-2016.jpg"</span></div><div class="line">      <span class="attr">thumb-src</span>=<span class="string">"/images/graphical-web-2016-thumb.png"</span></div><div class="line">      <span class="attr">thumb-width</span>=<span class="string">"2880"</span> <span class="attr">thumb-height</span>=<span class="string">"1800"</span></div><div class="line">      <span class="attr">style</span>=<span class="string">"background-color:#121513;width:100%"</span>&gt;</div><div class="line">    <span class="comment">&lt;!-- a div with intrinsic ratio --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">"padding-bottom:62.5%"</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- fallback for browsers not using JS / bots --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">noscript</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"/images/graphical-web-2016.jpg"</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p>I think it is a very good example of progressive enhancement, providing a <code>&lt;noscript&gt;</code> alternative, and going all the way up from a solid background-color, to a blurry gradient and finally the large image with support for webp.</p><h2 id="Wrapping-Up"><a href="#Wrapping-Up" class="headerlink" title="Wrapping Up"></a>Wrapping Up</h2><p>It’s very interesting seeing these slightly variations for implementing progressive image loading. Some of them work without Javascript, some others are built on responsive images, some use CSS filters and others canvas.</p><p>If you want to follow a basic example, check <a href="http://codepen.io/jmperez/pen/yYjPER" target="_blank" rel="external">my “Reproducing Medium loading image effect” pen</a>. Let me know if you come across any other site implementing these techniques.</p>]]></content>
    
    <summary type="html">
    
      Medium is not the only site using blurry placeholders. Let&#39;s look at how Quora and Quartz implement a similar technique.
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>SSL, HTTP/2, Service Worker, Offline Mode? This blog has all of them</title>
    <link href="https://jmperezperez.com/my-setup-for-this-blog/"/>
    <id>https://jmperezperez.com/my-setup-for-this-blog/</id>
    <published>2017-02-07T06:30:00.000Z</published>
    <updated>2017-02-07T16:53:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>I usually see myself spending more time migrating from one setup to another one than writing valuable content. After all, I consider my blog a playground where I try some concepts.</p><p>It is still <a href="http://jlongster.com/Presenting-The-Most-Over-Engineered-Blog-Ever" target="_blank" rel="external">not very over-engineered</a> and <a href="https://github.com/JMPerez/jmperez.github.com" target="_blank" rel="external">being open sourced and available on GitHub</a> I thought someone could benefit from it.</p><a id="more"></a><h2 id="Static-Site"><a href="#Static-Site" class="headerlink" title="Static Site"></a>Static Site</h2><p>The blog is a set of static pages. Before that it used to be a Wordpress site and eventually <a href="/migrating-wordpress-jekyll-github-pages">I migrated to Jekyll and GitHub Pages</a>. This worked really well because I could take advantage of GitHub’s distributed storage to serve the assets, and there is nothing that can beat a static site in terms of performance, which I care about.</p><p>In October 2016 I migrated to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>. Hexo is fast, and the posts are written in the same Markdown format I like and I used with Jekyll, so moving to Hexo was really easy.</p><p>Migrating to Hexo was a bit of a trade-off. Now I need to generate the static site from my computer and then deploy the files, instead of just using the GitHub editor, which was handy to fix small typos. The advantage is that I can create plugins in Javascript (and understand and tweak existing ones) to customise the output, which is better overall.</p><h2 id="Progressive-Images"><a href="#Progressive-Images" class="headerlink" title="Progressive Images"></a>Progressive Images</h2><p>The few JPG images on this site are progressive JPGs, <a href="/ssim-jpeg-io">generated using Jpeg.io</a>. Having a more custom technique to load images, like <a href="/medium-image-progressive-loading-placeholder">Medium’s approach</a>, is overkill. Progressive JPGs start rendering soon, and as the browser downloads more of the file it shows a better version of the image. You can see an example on <a href="https://www.webpagetest.org/result/170207_N3_1794c7ee69d5a1a3eb92842504f01a7b/" target="_blank" rel="external">this WebPageTest run</a>.</p><p><a href="/assets/images/posts/jmperez-filmstrip.png"><img src="/assets/images/posts/jmperez-filmstrip.png" alt="Filmstrip for jmperezperez.com"></a></p><p>Something in my to-do list is to prevent <a href="https://css-tricks.com/content-jumping-avoid/" target="_blank" rel="external">content jumping</a> by using some <a href="http://blog.learningspaces.io/flexible-cover-images-using-intrinsic-ratio/" target="_blank" rel="external">intrinsic ratio placeholders</a> for the images, and lazy-load them.</p><h2 id="SSL-and-HTTP-2"><a href="#SSL-and-HTTP-2" class="headerlink" title="SSL and HTTP/2"></a>SSL and HTTP/2</h2><p>This site is served on HTTPS. I already talked about <a href="/github-pages-ssl-custom-domain">how and why I migrated to SSL</a>. A good thing about using Cloudflare for SSL is that I also get HTTP/2 support, so I can start investigating it a bit more. I would like to give Server Push a try though, but for that I would need to run my own server. Maybe some time in the future.</p><p>Finally, Cloudflare also allows me to set the browser cache expiration, increasing the short one that GitHub Pages set by default.</p><h2 id="Accelerated-Mobile-Pages-aka-AMP"><a href="#Accelerated-Mobile-Pages-aka-AMP" class="headerlink" title="Accelerated Mobile Pages (aka AMP)"></a>Accelerated Mobile Pages (aka AMP)</h2><p>I’m not a big fan of <a href="https://www.ampproject.org/" target="_blank" rel="external">Google’s AMP</a>, <a href="https://instantarticles.fb.com" target="_blank" rel="external">Facebook’s Instant Articles</a> and <a href="https://developer.apple.com/news-publisher/" target="_blank" rel="external">Apple News</a>. I think developers can create experiences on the web with a good performance without having to resort to a subset of the language nor a specific markup for a proprietary crawler.</p><p>Still, I wanted to give AMP a try, so I now generate an AMP version of every post on build time. Does it have any impact in traffic? Well, not much yet. Only around 2% of the page views to this site are for AMP’d pages.</p><h2 id="Service-Worker-and-Offline-content"><a href="#Service-Worker-and-Offline-content" class="headerlink" title="Service Worker and Offline content"></a>Service Worker and Offline content</h2><p>The last addition to the site is a Service Worker which caches the main sections of this blog (home, projects, about) plus an offline page linking to those three. Additionally, if you visit a page it will be available when offline. I think it is a good trade-off.</p><p><a href="/sw.js">The implementation</a> is based on <a href="https://serviceworke.rs/strategy-cache-and-update_service-worker_doc.html" target="_blank" rel="external">the cache and update strategy</a> with a small variation. In my case I check the network, then the cache, and finally serve the <code>offline</code> page if no hit.</p><p>If you are thinking of making your site available when offline, be a good citizen. I have seen Service Workers that download all the posts from a blog. To be honest, this doesn’t do any good for your users. By doing so you might be killing their data plan or using precious space in their devices. If you still want to preload/prefetch/download content, do it wisely.</p><p>When browsing the App Store/Play Store, the user has an indication of the size of the app, so they might choose not to download it when they are using roaming or tethering. On the web we don’t have something like this.</p><h2 id="Performance"><a href="#Performance" class="headerlink" title="Performance"></a>Performance</h2><p>I like talking about web performance so my own site has to be a good example of what I advocate for. I use <a href="https://developers.google.com/speed/pagespeed/insights/?url=https%3A%2F%2Fjmperezperez.com" target="_blank" rel="external">PageSpeed Insights</a> to check the performance and usability on mobile (score &gt;=99/100 for most pages) and <a href="https://developers.google.com/web/tools/lighthouse/" target="_blank" rel="external">Lighthouse</a> (100/100).</p><p><a href="/assets/images/posts/jmperezperez-lighthouse.png"><img src="/assets/images/posts/jmperezperez-lighthouse.png" alt="Screenshot from Lighthouse for jmperezperez.com"></a></p><p>I’m looking forward to more ideas that I can apply to this blog and then some real project at scale :)</p>]]></content>
    
    <summary type="html">
    
      Some background on the hidden features of this blog. Static site, progressive images, AMP, HTTP/2, SSL...
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Reading List</title>
    <link href="https://jmperezperez.com/2017-01-reading-list/"/>
    <id>https://jmperezperez.com/2017-01-reading-list/</id>
    <published>2017-01-16T14:20:00.000Z</published>
    <updated>2017-02-04T16:59:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>I have decided to collect some of the best posts and articles I have read during last days. It is inspired by <a href="http://www.brucelawson.co.uk/" target="_blank" rel="external">Bruce Lawson</a>’s reading lists and web development newsletters. I write it to keep track of interesting content for myself, but you might also find it useful.</p><a id="more"></a><h2 id="Posts"><a href="#Posts" class="headerlink" title="Posts"></a>Posts</h2><ul><li><a href="https://www.filamentgroup.com/lab/modernizing-delivery.html" target="_blank" rel="external"><strong>Modernizing our Progressive Enhancement Delivery</strong></a>. Another excellent post by Filament Group. This time they talk about integrating HTTP/2 and ServiceWorker on their site, providing good performance and offline capabilities.</li><li><a href="https://developers.googleblog.com/2017/01/google-amp-cache-amp-lite-and-need-for.html" target="_blank" rel="external"><strong>Google AMP Cache, AMP Lite, and the need for speed</strong></a>. A post on how Google processes images in AMP articles to improve performance based on compression, responsive images and WebP. By the way, if you are into AMP, don’t miss <a href="https://www.ampproject.org/amp-conf-2017" target="_blank" rel="external">the first AMP Conf</a>, which will be live-streamed.</li><li><a href="https://blog.google/products/google-plus/saving-you-bandwidth-through-machine-learning/" target="_blank" rel="external"><strong>Saving you bandwidth through machine learning</strong></a>. Another post by Google, this time on upscaling small images while keeping crisp details and reducing the blurriness of traditional methods. The <a href="https://research.googleblog.com/2016/11/enhance-raisr-sharp-images-with-machine.html" target="_blank" rel="external">algorithm is called RAISR</a> and can be run on mobile devices in real time.</li><li><a href="https://developers.googleblog.com/2016/12/landlines.html" target="_blank" rel="external"><strong>Start with a line, let the planet complete the picture</strong></a>. A fun project in which you draw lines and get images from Google Maps to create an infinite line of rivers, roads or coastlines. It made me discover the <a href="https://en.wikipedia.org/wiki/Vantage-point_tree" target="_blank" rel="external">Vantage-point tree</a> structure.</li><li><a href="http://davidshariff.com/blog/preparing-for-a-front-end-web-development-interview-in-2017/" target="_blank" rel="external"><strong>Preparing for a Front-End Web Development Interview in 2017</strong></a>. A post by David Shariff, from Amazon, on the topics you should when interviewing for a front-end dev position.</li><li><a href="https://hackernoon.com/how-i-converted-my-react-app-to-vanillajs-and-whether-or-not-it-was-a-terrible-idea-4b14b1b2faff" target="_blank" rel="external"><strong>How I converted my React app to VanillaJS (and whether or not it was a terrible idea)</strong></a>. A long and insightful post on writing a website mimicking React’s approach using VanillaJS. If you like it, the same author wrote another good post called <a href="https://hackernoon.com/10-things-i-learned-making-the-fastest-site-in-the-world-18a0e1cdf4a7" target="_blank" rel="external">10 things I learned making the fastest site in the world</a> a few days ago.</li></ul><h2 id="Presentations"><a href="#Presentations" class="headerlink" title="Presentations"></a>Presentations</h2><ul><li><a href="http://presentations.survivejs.com/advanced-webpack/" target="_blank" rel="external"><strong>Advanced Webpack</strong></a>. A deck by <a href="https://twitter.com/bebraw" target="_blank" rel="external">Juho Vepsäläinen</a> explaining Webpack 2 configuration, code-splitting, plugins, loaders, optimising bundles and more.</li><li><a href="https://speakerdeck.com/btholt/preact-and-inferno" target="_blank" rel="external"><strong>Preact &amp; Inferno</strong></a>. A short deck by <a href="https://twitter.com/holtbt" target="_blank" rel="external">Brian Holt</a> from Netflix comparing react, preact and inferno. I can’t find a recording, but I think it is a good overview of three libraries that are solving the same problem.</li></ul><h2 id="Videos"><a href="#Videos" class="headerlink" title="Videos"></a>Videos</h2><ul><li><a href="https://vimeo.com/177267839" target="_blank" rel="external"><strong>What Comes Next Is The Future</strong></a>. A very interesting documentary about the Web that <a href="https://www.kickstarter.com/projects/bearded/what-comes-next-is-the-future" target="_blank" rel="external">started as a Kickstarter project</a> and is now available to everyone for free. A must-watch for every web developer to understand the history of web development.</li></ul><div class="videoWrapper"><iframe src="https://player.vimeo.com/video/177267839?byline=0&portrait=0" width="684" height="385" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen></iframe></div><h2 id="Books"><a href="#Books" class="headerlink" title="Books"></a>Books</h2><ul><li><a href="https://resilientwebdesign.com/" target="_blank" rel="external"><strong>Resilient Web Design</strong></a>. A book I’ve been reading these days about the history of web and how we ended up where we are. It is free and <a href="https://adactio.com/journal/11670" target="_blank" rel="external">available in many formats</a>: web, PDF, MOBI, EPUB…</li></ul>]]></content>
    
    <summary type="html">
    
      Reading List with some articles from December 2016 - January 2017
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Assessing New Technology</title>
    <link href="https://jmperezperez.com/assessing-new-technology/"/>
    <id>https://jmperezperez.com/assessing-new-technology/</id>
    <published>2017-01-03T07:10:00.000Z</published>
    <updated>2017-01-03T08:10:30.000Z</updated>
    
    <content type="html"><![CDATA[<p>Try this library, it’s the best thing ever. Try this technique, it will make your site automatically faster. I read and hear people praising libraries or technologies very often. It can come as a blog post, talk at a conference or informal conversation. It is fine to talk about the benefits of using A over B, but be alert if A doesn’t seem to have any drawbacks.</p><a id="more"></a><p><img src="/assets/images/posts/tools.jpg" alt="A picture of some tools"></p><p>I have done it myself. Most devs (at least web ones) are excited about the progress in network protocols, browser APIs and libraries amongst others. Gone are the days of building web sites for Netscape and &lt;IE6 with FrontPage, debugging with alerts, requesting many unminified files. I don’t want to go back to those days, and I hope you do not either.</p><p>It might be that I’m getting old, grumpy and boring. Or “experienced” might be the word. I even think it might have to do with web fatigue (à la JS).</p><p>HTTP/2, React, AMP, BEM… every new thing seems to fix the pains of our web sites. <strong>And we don’t do ourselves a favour when we jump on the bandwagon and amplify their benefits, without even trying them out</strong>. Without being capable of understanding the effects of embracing them. The negative effects.</p><p>We shouldn’t become sales people, but engineers with a toolset, aware of the limitations and trade-offs of each of them. <strong>No single tool is the best one for every project</strong>.</p><p>The contrary also happens many times. People will also criticise without having enough information, only because the general consensus is to be against it (eg using jQuery or Angular). Sometimes it looks like it’s a “with me or against me” situation.</p><h2 id="Trade-offs-and-nuances"><a href="#Trade-offs-and-nuances" class="headerlink" title="Trade-offs and nuances"></a>Trade-offs and nuances</h2><p>I appreciate it when people talk honestly about technology and don’t get driven by the idea that the new thing is always better. Sure, it has been created for a reason, probably to fill a gap or improve a specific aspect, but it will likely come with some problems.</p><p>Everything is fine when you are implementing <em>Hello World</em> (should I say also a <em>Todo app</em>)? However, it might not work for another project, like the one you are involved right now at your company. Those need to be stable, scalable, testable and maintainable.</p><h2 id="Talking-publicly-about-new-tech-conferences-and-blog-posts"><a href="#Talking-publicly-about-new-tech-conferences-and-blog-posts" class="headerlink" title="Talking publicly about new tech - conferences and blog posts"></a>Talking publicly about new tech - conferences and blog posts</h2><p>I find it quite valuable when someone talks about using a certain technology applied to a real project. They are usually stories about illusions, obstacles, work-arounds, trade-offs. Those are close to real life experiences than what most sources will claim.</p><p>Before recommending a solution, make sure you know about its drawbacks. Don’t limit yourself to describe its benefits. <strong>Tell how you tried to apply it, what issues you found and how you managed to solve or mitigate them</strong>.</p><p>I like watching recorded talks from web conferences. I think that the best talks are those about real projects where something went wrong. Basically, any real project. Even better when the speaker works at a medium-size company, where projects are big large enough to have representative issues, and the company is small enough so the speaker can give details openly.</p><p>If you need some examples, check out these talks:</p><ul><li><a href="https://www.youtube.com/watch?v=3WIDa5-bPDs" target="_blank" rel="external">Michael Mifsud’s “Real World HTTP/2”</a> on the effects of applying HTTP/2 to 99designs’s web site.</li><li>Vitaly Friedman’s “How We Moved To HTTP/2 To Improve Performance… And Failed” on how <a href="https://www.smashingmagazine.com" target="_blank" rel="external">Smashing Magazine</a> was moved to HTTP/2 and had issues with web fonts and ads. Unfortunately, there is no recording, but his talk <a href="https://www.youtube.com/watch?v=a_1--3T8y6Y" target="_blank" rel="external">Cutting-Edge Responsive Web Design</a> covers some of these points.</li><li><a href="https://www.youtube.com/watch?v=skzcEKewOwc" target="_blank" rel="external">Ally Palanzi’s Accessibility matters. Let’s do something about it</a> on how to drive awareness about accessibility at a company and make it part of the development workflow.</li><li><a href="https://vimeo.com/144499045" target="_blank" rel="external">Espen Brunborg, Gordon McLachlan and Bart Oleszczyk’s Walking the Tightrope Between Mediocrity and Bankruptcy</a> on the challenge to build good projects and keep clients happy.</li><li><a href="https://www.youtube.com/watch?v=9UsnX5X_DF0" target="_blank" rel="external">Felipe Ribeiro’s JavaScript @ Spotify</a> on how Spotify embraced web to build the desktop client and the journey to balance teams autonomy and consistency in tech.</li></ul><p>In short, look for content explaining issues encountered while adopting that technology.</p><h2 id="Assessing-technology"><a href="#Assessing-technology" class="headerlink" title="Assessing technology"></a>Assessing technology</h2><p>When assessing a piece of technology like a library, framework, compression algorithm, etc, ask yourself these questions:</p><p><strong>How mature is it?</strong></p><p>In general, the longer it has been around, the more scenarios it’s been used on, more bugs have been fixed, more documentation is available and more people able to help you if issues arise.</p><blockquote><p>The nice thing about boringness (or constrained) is that the capabilities of these things are well understood. But more importantly, their failure modes are well understood — Dan McKinley on <a href="http://mcfunley.com/choose-boring-technology" target="_blank" rel="external">Choose Boring Technology</a>.</p></blockquote><p>The fact that it is used by a large company definitely helps getting some backing. Still, that company might have resolved issues with tooling that won’t necessarily share publicly.</p><p><strong>What will be the technical problems if I use it for my project?</strong></p><p>Performance issues? Increase in build time? Dependencies you don’t control? Sooner than later you will need to dig into the internals of the technology to understand what is going on.</p><p><strong>Will it be embraced/enforced in my project?</strong></p><p>For this, other members in the project need to be knowledgeable so they can maintain it and apply it to new areas of the project. Otherwise it will become something you introduced that nobody feels comfortable with. That is why it is important to get buy-in from your colleagues, document the solutions and use tools like linters and checkers to enforce these solutions.</p><h2 id="Apply-it-to-a-small-project"><a href="#Apply-it-to-a-small-project" class="headerlink" title="Apply it to a small project"></a>Apply it to a small project</h2><p>I’m not saying you shouldn’t try out that new shiny thing.</p><p>Let’s say React seems to solve some problems you are facing in a project, or at least that’s what you think after seeing all the hype about Facebook’s library. Try building first a side project with it, or a prototype that resembles the project you are working on. Don’t skip aspects like expressiveness, debuggability, performance, testability and scalability. Sure, it’s going to be very difficult to know about these unless you make the project larger, or do some research.</p><p>If you can’t spend your free time on a side project, ask for some time to work on a prototype. It will help if you time-box it, so your colleagues and stakeholders can expect some conclusions on a given date. Some companies also arrange hack days, hackathons or something like Google’s 20% that you can use to experiment.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Let’s try to get more informed about how every tool fits in our projects, their limitations and how to choose the most suitable one given a set of constraints. Our approach should be analytical, and not get driven by the novelty or the feeling of a few people.</p>]]></content>
    
    <summary type="html">
    
      It is easy to bless or criticise a piece of technology without understanding what they do. Let&#39;s change this.
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>My 2016</title>
    <link href="https://jmperezperez.com/my-2016/"/>
    <id>https://jmperezperez.com/my-2016/</id>
    <published>2016-12-31T10:39:00.000Z</published>
    <updated>2016-12-31T11:39:50.000Z</updated>
    
    <content type="html"><![CDATA[<p>I don’t usually post a summary of the year, but I’m particularly happy about how 2016 developed and want to do balance. It’s been very positive, both personally and professionally, and hope 2017 will be even better.</p><a id="more"></a><h2 id="Blogging"><a href="#Blogging" class="headerlink" title="Blogging"></a>Blogging</h2><p>During this year I wrote 8 blog posts. It’s not a big number since I only write when I feel like I have something to share, often related to projects at work.</p><p>I migrated this blog from Jekyll to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>, which I feel quite comfortable with. Jekyll was great but I wanted to have more control on the generation of the posts, and I’m not that familiar with python and the ecosystem of gems. <a href="https://github.com/JMPerez/jmperez.github.com" target="_blank" rel="external">With Hexo</a> I also added support for <a href="https://www.ampproject.org/" target="_blank" rel="external">Google’s AMP</a>. My site has great performance, but AMP makes it load even faster from Google search results.</p><p>I also decided to <a href="https://medium.com/@jmperezperez" target="_blank" rel="external">import my blog posts on Medium</a>. This allows me to be on that platform while keeping the canonical content on my site.</p><p>The most visited posts on the blog during 2016 have been:</p><ol><li><a href="/medium-image-progressive-loading-placeholder">How Medium does progressive image loading</a></li><li><a href="/jpegoptim-optimize-jpg-page-speed">Optimizing images for web with Google Page Speed and jpegoptim</a></li><li><a href="/webp-placeholder-images">Using WebP to create tiny preview images</a></li></ol><p>It is clear that images and their role in web performance are the most interesting content on the blog.</p><h2 id="Open-source-projects"><a href="#Open-source-projects" class="headerlink" title="Open source projects"></a>Open source projects</h2><p>I contributed to DuckDuckGo with a small <a href="https://duck.co/ia/view/spotify" target="_blank" rel="external">Spice Instant Answer that fetches results from Spotify</a>, created a <a href="https://github.com/JMPerez/spotify-web-api-js-poc" target="_blank" rel="external">proof-of-concept universal wrapper for Spotify using ES6</a> and <a href="https://github.com/JMPerez/spotify-desktop-proxy" target="_blank" rel="external">a proxy desktop app to make it easy to work with authenticated endpoints</a>. Last, but not least, <a href="https://github.com/JMPerez/screenflow" target="_blank" rel="external">a fun project to record the screen and webcam using browser APIs</a>.</p><h2 id="Conferences"><a href="#Conferences" class="headerlink" title="Conferences"></a>Conferences</h2><p>This year I attended <a href="https://skillsmatter.com/conferences/7278-fullstack-2016-the-conference-on-javascript-node-and-internet-of-things" target="_blank" rel="external">FullStack 2016 in London</a> and <a href="/cssconf-au-2016">spoke at CSSConf/JSConf/Decompress Australia 2016</a>. It had been 3 years since <a href="/spain-js-2013">I spoke at Spain.js 2013</a> and it was great to go through that stress and nerves of speaking to a large audience, and I came back with good memories from Melbourne.</p><h2 id="Work"><a href="#Work" class="headerlink" title="Work"></a>Work</h2><p>This year was my forth one at Spotify and I worked in a couple of projects that I am enjoining a lot. Hopefully I will be able to share more on those in the coming months.</p>]]></content>
    
    <summary type="html">
    
      Wrapping up 2016
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Using MediaRecorder API for screen recording on the web</title>
    <link href="https://jmperezperez.com/mediarecorder-api-screenflow/"/>
    <id>https://jmperezperez.com/mediarecorder-api-screenflow/</id>
    <published>2016-12-08T23:05:00.000Z</published>
    <updated>2017-01-28T18:46:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>At <a href="/cssconf-au-2016/">CSSConf AU 2016</a>, <a href="https://soledadpenades.com/" target="_blank" rel="external">Soledad Penadés</a> gave a talk called “<a href="https://soledadpenades.com/files/t/2016_rtalchemy/" target="_blank" rel="external">Real time front-end alchemy</a>“. It was full of examples of combining <a href="https://developer.mozilla.org/en-US/docs/Web/API/Media_Streams_API" target="_blank" rel="external">MediaStreams</a> with audio and video manipulation.</p><p>Something I didn’t know was that you can record audio and video on the browser without any plugins. You can combine audio from the microphone, video from a canvas, dynamically generated content… you name it. Even recording a window or the entire screen and exporting it as a video.</p><a id="more"></a><p>The best way to learn is by practising and, <a href="https://soledadpenades.com/files/t/2016_rtalchemy/#65" target="_blank" rel="external">quoting Soledad</a>, “we need you to play with it, contribute and help us make it better”. By trying these new APIs out we let browser-vendors know that these tools are useful, and we can test and provide early feedback.</p><h2 id="The-project"><a href="#The-project" class="headerlink" title="The project"></a>The project</h2><div class="videoWrapper"><iframe width="720" height="450" src="https://www.youtube.com/embed/tOWwV8ZRn3g" frameborder="0" allowfullscreen></iframe></div><p>I had this idea about creating a <a href="http://www.telestream.net/screenflow/overview.htm" target="_blank" rel="external">ScreenFlow</a>-like prototype. I would show my webcam in a corner of the screen and I would generate a video combining audio from the mic and the image from the screen.</p><p>I Googled a bit, and found very few sites talking about these APIs. Pretty much only <a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API" target="_blank" rel="external">MDN</a> and <a href="https://hacks.mozilla.org/2016/04/record-almost-everything-in-the-browser-with-mediarecorder/" target="_blank" rel="external">other post by Sole</a>. I thought this small experiment would also help those searching for some examples.</p><p><em>Note: As of December 2016 this demo is only supported on Firefox. Chrome is not supported out of the box, needing an extension and lots of custom code (see this WebRTC experiment for more information. It will show your camera, but won’t record anything.</em></p><h3 id="The-code"><a href="#The-code" class="headerlink" title="The code"></a>The code</h3><p>The code for the project is at <a href="https://github.com/JMPerez/screenflow" target="_blank" rel="external">JMPerez/screenflow on GitHub</a> and a demo is available on <a href="https://jmperezperez.com/screenflow/">jmperezperez.com/screenflow</a>.</p><p>Let’s have a look at the most important code fragments. First of all, we define functions to request access to the different media sources:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// we ask for permission to record the window</span></div><div class="line"><span class="comment">// mediaSource could also be 'screen' if we wanted</span></div><div class="line"><span class="comment">// to record the entire screen</span></div><div class="line"><span class="keyword">const</span> getStreamForWindow = <span class="function"><span class="params">()</span> =&gt;</span> navigator.mediaDevices.getUserMedia(&#123;</div><div class="line">  <span class="attr">video</span>: &#123;</div><div class="line">    <span class="attr">mediaSource</span>: <span class="string">'window'</span></div><div class="line">  &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// we ask for permission to record the audio and video from the camera</span></div><div class="line"><span class="keyword">const</span> getStreamForCamera = <span class="function"><span class="params">()</span> =&gt;</span> navigator.mediaDevices.getUserMedia(&#123;</div><div class="line">   <span class="attr">audio</span>: <span class="literal">true</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>Now, we execute them, one after the other one. I tried to execute both in parallel, believing that the browser would combine both requests in the permission dialog, but that didn’t work. So the idea is to request access to the webcam, insert a <code>&lt;video&gt;</code> element with the media from the camera and then request access to the screen and record it.</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line">getStreamForCamera().then(<span class="function"><span class="params">streamCamera</span> =&gt;</span> &#123;</div><div class="line">    <span class="comment">// we know have access to the camera, let's append it to the DOM</span></div><div class="line">    appendCamera(streamCamera);</div><div class="line">    getStreamForWindow().then(<span class="function"><span class="params">streamWindow</span> =&gt;</span> &#123;</div><div class="line"></div><div class="line">      <span class="comment">// we now have access to the screen too</span></div><div class="line">      <span class="comment">// we generate a combined stream with the video from the</span></div><div class="line">      <span class="comment">// screen and the audio from the camera</span></div><div class="line">      <span class="keyword">var</span> finalStream = <span class="keyword">new</span> MediaStream();</div><div class="line">      <span class="keyword">const</span> videoTrack = streamWindow.getVideoTracks()[<span class="number">0</span>];</div><div class="line">      finalStream.addTrack(videoTrack);</div><div class="line">      <span class="keyword">const</span> audioTrack = streamCamera.getAudioTracks()[<span class="number">0</span>];</div><div class="line">      finalStream.addTrack(audioTrack);</div><div class="line">      <span class="keyword">this</span>.recorder = <span class="keyword">new</span> MediaRecorder(finalStream);</div><div class="line"></div><div class="line">      <span class="comment">// we subscribe to 'ondataavailable'.</span></div><div class="line">      <span class="comment">// this gets called when the recording is stopped.</span></div><div class="line">      <span class="keyword">this</span>.recorder.ondataavailable = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</div><div class="line">        <span class="comment">// let's create a blob with e.data which has the</span></div><div class="line">        <span class="comment">// contents of the video in webm</span></div><div class="line">        <span class="keyword">var</span> link = <span class="built_in">document</span>.createElement(<span class="string">'a'</span>);</div><div class="line">        link.setAttribute(<span class="string">'href'</span>, <span class="built_in">window</span>.URL.createObjectURL(e.data));</div><div class="line">        link.setAttribute(<span class="string">'download'</span>, <span class="string">'video_'</span> + <span class="built_in">Math</span>.floor((<span class="built_in">Math</span>.random() * <span class="number">999999</span>)) + <span class="string">'.webm'</span>);</div><div class="line">        link.style.display = <span class="string">'none'</span>;</div><div class="line">        <span class="built_in">document</span>.body.appendChild(link);</div><div class="line">        link.click();</div><div class="line">        <span class="built_in">document</span>.body.removeChild(link);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="comment">// start recording</span></div><div class="line">      <span class="keyword">this</span>.recorder.start();</div><div class="line">    &#125;);</div><div class="line">  &#125;);</div></pre></td></tr></table></figure><p>Now, we finally need to call <code>this.recorder.stop()</code> whenever we want to stop the recording, which will make the browser save the file automatically. In my example, I’m attaching a key event listener for the “escape” key.</p><h3 id="A-note-about-permissions"><a href="#A-note-about-permissions" class="headerlink" title="A note about permissions"></a>A note about permissions</h3><p>In order to make this work you will need to whitelist the domain trying to record your screen. On Firefox, <code>localhost</code> will work out of the box. If you want to publish the code somewhere else, like GitHub Pages, make sure you whitelist it.</p><p>On Firefox, navigate to <code>about:config</code> and look for the key <code>media.getusermedia.screensharing.allowed_domains</code>. Add your domain to the list and restart the browser. Then, when you are running the code, the user will be able to grant access for both the webcam and the screen.</p><p>It is unclear whether this will be how a user lets a site record their screen, but it is how this works at the moment.</p><h3 id="A-step-further-making-this-embeddable"><a href="#A-step-further-making-this-embeddable" class="headerlink" title="A step further, making this embeddable"></a>A step further, making this embeddable</h3><p>The example code worked fine, but I wanted to take it a bit further. What if I wanted to use this “recording” functionality in more than one project? Also, given that the user has to whitelist a domain, we could serve the code from an <code>iframe</code> on that domain, so we wouldn’t need to add more domains to the <code>about:config</code>.</p><p>The final version of the prototype is based now on a script that you include on a page. The script appends an <code>iframe</code>, which executes the code we saw above and shows the output from the webcam at full size. Apart from the <code>iframe</code>, it also binds several key event listeners to toggle the visibility and size of the <code>iframe</code>.</p><p>These are the keys you can press to perform some actions:</p><ul><li>Escape: finishes the recording and saves the file</li><li>s: Switches the camera between full page and picture-in-picture</li><li>a: Toggles the visibility of the camera</li></ul><p>You can then include the script to any page to get this screen recording functionality. For instance, we can include <code>https://jmperezperez.com/screenflow/lib/embed.js</code> on a codepen and record a screencast.</p><h3 id="Limitations"><a href="#Limitations" class="headerlink" title="Limitations"></a>Limitations</h3><p>Keep in mind this is only a proof of concept and doesn’t have any real utility. If you are serious about recording a screencast, don’t use this hack :)</p><p>There are, of course, some limitations:</p><ul><li>The iframe with the camera is shown on top of the hosting page, but it will be hidden if we put some other window on top.</li><li>If we navigate from the hosting page to somewhere else we will lose the recording. This can be workaround by having, in the hosting page, an iframe for the camera and another iframe for the page we are recording, in full screen</li><li>If we click on the iframe with the camera, the key events will stop working because the hosting page doesn’t receive those. This can be solved sending <code>postMessage</code>s from the iframe to the hosting page.</li></ul>]]></content>
    
    <summary type="html">
    
      Record your webcam and screen using Javascript to create screencast from your browser.
    
    </summary>
    
    
      <category term="images" scheme="https://jmperezperez.com/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>Speaking at CSSConf Australia 2016</title>
    <link href="https://jmperezperez.com/cssconf-au-2016/"/>
    <id>https://jmperezperez.com/cssconf-au-2016/</id>
    <published>2016-12-01T09:46:00.000Z</published>
    <updated>2017-05-19T20:15:25.000Z</updated>
    
    <content type="html"><![CDATA[<p>I just attended <a href="http://2016.cssconf.com.au" target="_blank" rel="external">CSSConf Australia in Melbourne</a>, where I gave a talk about images and web performance. It was a blast! Very well organised and with a great atmosphere. In this post I give a short introduction about the event and I include links to the slides, videos and the script. <img src="/assets/images/posts/cssconf-au-2016-sign.jpg" alt="The CSSConf AU 2016 sign at the entrance"></p><a id="more"></a><h2 id="Call-for-Papers-and-Organization"><a href="#Call-for-Papers-and-Organization" class="headerlink" title="Call for Papers and Organization"></a>Call for Papers and Organization</h2><p>Back in August I sent a proposal for <a href="http://2016.cssconf.com.au/call-for-speakers/" target="_blank" rel="external">CSSConf AU 2016’s Call For Papers</a> and I got accepted. Just by reading their CFP it was clear this event was very well organised. I liked that the projects and companies mentioned in the CFP had to be renamed to PROJECT_A, COMPANY_A, etc to make the selection process more fair. It’s also refreshing seeing speakers with very different background, and I love how the organisation has made diversity and inclusion the pillars of the triplet CSSConf / JSConf / Decompress. Details like the variety of food and live captioning show that they are serious about it.</p><p>As a speaker, they have been very supportive providing all the information about the event way ahead of time, and offering help with the design of the slides and preparation. And once in Melbourne they also prepared a nice welcome pack, including a SIM card that has been great for me to be in contact with my family during these days.</p><p>When they say it’s taken them 9 months to prepare the conference I don’t question it. One can see they had covered every little detail.</p><p>I recommend to check <a href="http://brett.cool/photoessays/2016/cssconfau/" target="_blank" rel="external">Brett Jones’ write-up about the event</a>, that is full with great pictures and descriptions about the talks.</p><p>Personally, it’s the first time I travel so far from home, and I have also accomplished a personal dream of speaking at a top-level large conference.</p><h2 id="My-talk-about-“Progressive-Image-Rendering”"><a href="#My-talk-about-“Progressive-Image-Rendering”" class="headerlink" title="My talk about “Progressive Image Rendering”"></a>My talk about “Progressive Image Rendering”</h2><p>The talk I gave is based on some posts I have been writing during last 1.5 years. It’s a combination of insights while redesigning (and rewriting) <a href="https://open.spotify.com" target="_blank" rel="external">open.spotify.com</a>, plus some smaller projects I had been working on, also related with images.</p><p>A month before the talk, the folks at <a href="https://www.meetup.com/es-ES/Stockholm-Web-Performance-Group/events/234796510/" target="_blank" rel="external">Stockholm Web Performance Group</a> gave me a slot in one of their Meetups to present it, which was really useful to get feedback. I fixed some typos, investigated some information that was missing and adjusted the length. Presenting it to a smaller audience made me present a first version of the talk, which I polished thanks to their feedback and an extended Q&amp;A session, and be more confident.</p><h3 id="Slides-and-video"><a href="#Slides-and-video" class="headerlink" title="Slides and video"></a>Slides and video</h3><p>The slides are available on <a href="https://jmperezperez.com/cssconfau16/">jmperezperez.com/cssconfau16</a> and contain some animations and videos. A <em>static</em> version <a href="https://speakerdeck.com/jmperez/progressive-image-rendering" target="_blank" rel="external">is available on SpeakerDeck</a>.</p><div class="videoWrapper"><iframe width="560" height="315" src="https://speakerdeck.com/player/26551189899c4996a8f9fae2b5e8e10a"></iframe></div><p><a href="https://www.youtube.com/watch?v=szmVNOnkwoU" target="_blank" rel="external">The video of the talk is on Youtube</a>:</p><div class="videoWrapper"><iframe width="560" height="315" src="https://www.youtube.com/embed/szmVNOnkwoU" frameborder="0" allowfullscreen></iframe></div><p>Last, but not least, <a href="https://twitter.com/ghammadi" target="_blank" rel="external">Guillaume Hammadi</a> drew this amazing illustration that summarises the talk:</p><p><blockquote class="twitter-tweet" data-lang="en-gb"><p lang="en" dir="ltr">Progressive image <a href="https://twitter.com/hashtag/rendering?src=hash" target="_blank" rel="external">#rendering</a> by <a href="https://twitter.com/jmperezperez" target="_blank" rel="external">@jmperezperez</a> at <a href="https://twitter.com/cssconfau" target="_blank" rel="external">@cssconfau</a> <a href="https://twitter.com/hashtag/cssconfau16?src=hash" target="_blank" rel="external">#cssconfau16</a> <a href="https://t.co/pKtcWWvjVL" target="_blank" rel="external">pic.twitter.com/pKtcWWvjVL</a></p>&mdash; guillaume hammadi (@ghammadi) <a href="https://twitter.com/ghammadi/status/803830326657249282" target="_blank" rel="external">30 November 2016</a></blockquote></p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script><h3 id="Script"><a href="#Script" class="headerlink" title="Script"></a>Script</h3><p>Here is the script I had prepared for the talk. Of course I failed to stick to 100%.</p><hr><h4 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h4><p>As users we like applications and websites to load fast, or at least feel like the load fast. As developers we struggle finding the best way to optimize and serve the assets needed for our projects in the best way.</p><p>We tend to talk a lot about the size of CSS and JS. We love discussing about this or that library, on saving some bytes at the cost of functionality. React vs preact?</p><p>It is very easy to forget about images. Images still represent roughly two thirds of the size of a web page, and the trend is pretty stable, increasing over time. Let’s not forget about the main culprit.</p><p>In this presentation I want to discuss about images, making the case for using them and only then find the best way to serve them. I will talk about different ways to load images that some sites and applications use in real life. They try to improve the user’s perceived performance using placeholders, blurry thumbnails and dominant colours.</p><p>Some of them are not as standard as we would like them to be, but they are there to fill a gap.</p><p>Like most developers, I try to get up to date with the latest techniques to build fast and pretty websites. I try many things, but only a few end up working. Some of those techniques are good in theory, but don’t cover our use case completely.</p><p>I will show some examples of pages I have implemented or seen out there, and the issues found addressing image performance.</p><h4 id="The-case-for-using-images"><a href="#The-case-for-using-images" class="headerlink" title="The case for using images"></a>The case for using images</h4><p>We’ve been using images on the web for a long time. Not only to show nice pictures, but also for rounded corners and gradients before CSS finished with these hacks. But it would be silly to try to improve the perceived performance of images that are not optimized, or are not even needed.</p><p>With the trend of flat and minimalist design we have reduced the need of images on the web. Fewer images also means less problems to make our site look good on multiple devices without sending too many bytes down the wire. And reducing images, especially bitmap ones, prevents us from generating several sizes and keeping an “original” image for future modifications (think of PSD files).</p><p>The fact of reducing the need of images also means that there is more bandwidth to load other resources. This is especially important in slow networks.</p><p>Some images might look great on desktop but provide little value on mobile. Maybe we don’t even need to load that image in certain viewports. Setting the display property to “none” will hide the image, but won’t prevent the browser from requesting it. A better alternative is to set a background-image using CSS. Similarly, hiding sections in your markup that contain images won’t prevent the request. A better approach is to use a template engine that only adds to the markup the needed section. These days lots of people use a component-based library that will take care of this.</p><h4 id="Optimising-images"><a href="#Optimising-images" class="headerlink" title="Optimising images"></a>Optimising images</h4><p><em>More info on <a href="/ssim-jpeg-io">JPG compression level, SSIM and Jpeg.io</a></em></p><p>I can’t find a reason why not to optimize images. We have had good tools like jpegoptim and imageoptim for a long time. They will output the same image with fewer bytes. For formats like JPEG it is difficult for us to choose what compression level we should use. 80? 90? It really depends on the source image. There are tools that will find the best compression level to generate an image that is visually identical to a given one.</p><p>Performance is a difficult topic. A heavier page might be perceived as faster. Think of a page that inlines its critical CSS and lazy loads the full stylesheet. Overall, it is sending more bytes, but it will be perceived as faster.</p><h4 id="Picture-element-and-srcset-sizes"><a href="#Picture-element-and-srcset-sizes" class="headerlink" title="Picture element and srcset/sizes"></a>Picture element and srcset/sizes</h4><p>We have seen examples where we could avoid requesting an image and have gone through optimizations that we can apply to an image. For large images we have a valuable HTML element and img’s attributes we can use. We can finally use responsive images in all modern browsers. You define what images you want to serve depending on some media queries.</p><p>In theory it is a good approach, in practice I see two things that are far from ideal.</p><p>Firstly, the browser knows the dimensions of the window, but needs extra information to pick the right image to download. This is so it can request the images without having to wait until the CSS is downloaded and parsed. The markup can get quite verbose, and these values depend on the visual design, which CSS is supposed to dictate. In the end you end up with duplication, and it is not easy to defined those media queries once and import them both in CSS and HTML.</p><p>Secondly, the lack of a standard lazy-loading solution. Most users don’t scroll through the whole page, and it makes sense to delay the request of images below the fold until they are needed. The most performant request is the one that is never made. You want to use <code>&lt;img&gt;</code> for all images, since it’s the most sensible and standard thing to do. But the browser sees them and requests all of them even if they are far from the visible area. I wish there was a way for browsers to do this in a standard way.</p><p>A middle ground is to use responsive images for above the fold content, and lazy load the rest. This is in fact what we do in Spotify for pages like albums, where we display the cover art above the fold, and then we show a section with more albums by that artist, in which we lazy load the images.</p><h4 id="How-to-lazy-load"><a href="#How-to-lazy-load" class="headerlink" title="How to lazy load"></a>How to lazy load</h4><p><em>More info on <a href="/lazy-loading-images">How to lazy-load images to improve loading time and save bandwidth</a></em></p><p>When doing lazy load, we want to detect when the page is scrolled or resized, and then check whether the placeholder for our image is within the rendered section of the page. And this needs to be performed for all the images we want to lazy load.</p><p>Scroll listeners can have a negative impact in scrolling performance. During the scroll movement, the browser triggers many scroll events, and finding out the position and dimension of our images causes a layout recalculation. This is an expensive operation that makes the browser spend too long drawing frames, producing stuttering when scrolling. So what should be an improvement might spoil the perceived performance.</p><p>There is an experimental API called IntersectionObserver that suits very well this use case. Instead of subscribing to the scroll event, and then go through the lazy-loaded images, IntersectionObserver allows us to subscribe to an event that is triggered when the image enters the rendered area (viewport).</p><p>It is supported in Chrome and Opera, and in development in Firefox and Edge.</p><h4 id="What-to-show-while-the-image-is-loading"><a href="#What-to-show-while-the-image-is-loading" class="headerlink" title="What to show while the image is loading"></a>What to show while the image is loading</h4><p>An interesting topic in loading images is what to show until the image is downloaded. And this is even more important when doing lazy loading.</p><p>When the image is loading we can do several things. The easiest one is not to do anything. We reserve some area in which the image will be eventually loaded. Another possibility is showing a placeholder. If you do this, try to use inlined SVG so they are served quicker.</p><p>Then we have the more interesting options. One could fill the area where an image is going to be loaded with a solid colour. The colour will be obtained from the image. It can be the dominant colour, the more vivid colour… There are libraries to extract these colours as a palette. A drawback is that you need some pre-processing of your images to calculate these colours.</p><p>One last option is to use a small version of the image, like a thumbnail, scale it and apply a blur effect. For this one you need to generate that smaller image, so it is the option that increases the size of the overall page the most.</p><p>Solid colour and blurry images are the ones that are used to improve user’s perceived performance. We will see how real sites put them in practice.</p><h4 id="Examples-of-solid-colour"><a href="#Examples-of-solid-colour" class="headerlink" title="Examples of solid colour"></a>Examples of solid colour</h4><p>First of all, let’s see examples of using a solid colour as the background.</p><p>Google added recently an option to Google Chrome, especially targeted to slow connections. In those cases it doesn’t serve images, replacing them with a solid colour. Then, once the user taps on “Load images”, those images are requested.</p><p>Arts and Culture is another example by Google, where you can browse art from museums. The placeholders give us a hint: we know that an image will appear there, we know the dimensions and we see a pleasant colour that transitions to the full image.</p><p>We don’t need to go too far to see this in action. Search for images on Google and you’ll see those placeholders. In case you are wondering, I was throttling the connection to record this. But if you are using a shared connection, or using internet on a plane, you will see them.</p><h4 id="Examples-of-Progressive-Image-Loading"><a href="#Examples-of-Progressive-Image-Loading" class="headerlink" title="Examples of Progressive Image Loading"></a>Examples of Progressive Image Loading</h4><p><em>More info on <a href="/medium-image-progressive-loading-placeholder">How Medium does progressive image loading</a></em></p><p>Moving on, let’s see some examples of sites that show a blurry image to transition to the final image.</p><p>One of the biggest sites using it is Medium. In this video we can see what the transition looks like. And because is web, we can inspect and see what’s going on behind the scenes. In order to do this they render a div, then they request a small thumbnail image, which they draw to a canvas. Then thy apply a blur effect. At the same time they request the large image, and when it is received they replace the canvas with the image.</p><p>The markup for the technique includes a <code>&lt;div&gt;</code> for setting an intrinsic aspect ratio, then we have the small image, the large one, the canvas and a <code>&lt;noscript&gt;</code> tag to support browsers with JS disabled.</p><p>There are 2 interesting points in Medium’s implementation. One is that the thumbnail, though very small, it’s an external file. They could as well have inlined it in the initial payload. Secondly, <code>&lt;canvas&gt;</code> is an option for accomplishing the blur effect, but so are blur filter that can be applied using CSS or SVG.</p><p>Overall, one can’t say it is straightforward, but the point is to achieve lazy-loading of images, and a seamless transition between a small thumbnail and the large image to improve perceived performance.</p><h4 id="How-do-users-perceive-it"><a href="#How-do-users-perceive-it" class="headerlink" title="How do users perceive it?"></a>How do users perceive it?</h4><p>It seems fair to ask ourselves how do users see it?. I searched on Twitter to find some reactions and this is what I found.</p><p>But since this is a subjective topic, we also find people who don’t like it. This shouldn’t surprise us. We have had a similar technique for a long time in the form of progressive JPEGs. However, only 7% of JPEG images are progressive.</p><blockquote><p>“When, as with the Progressive JPEG method, image rendition is a two-stage process in which an initially coarse image snaps into sharp focus, cognitive fluency is inhibited and the brain has to work slightly harder to make sense of what is being displayed.”</p></blockquote><p>Users find it more difficult to process progressive JPEGs, even though at first sight we would think the experience is better.</p><h4 id="Is-this-technique-reliable"><a href="#Is-this-technique-reliable" class="headerlink" title="Is this technique reliable?"></a>Is this technique reliable?</h4><blockquote><p>“If you’re viewing this on desktop and the above image looks a bit blurry, please refresh the page…”</p></blockquote><p>It turns out that sometimes users end up just seeing the blurry images… which is probably worst than not seeing nothing at all.</p><h4 id="Facebook-Inlining-thumbnail-image-in-payload"><a href="#Facebook-Inlining-thumbnail-image-in-payload" class="headerlink" title="Facebook - Inlining thumbnail image in payload"></a>Facebook - Inlining thumbnail image in payload</h4><p>Medium are not alone on this. Facebook has also experimented with it for their mobile client in developing markets like India. For loading a profile page for a user, their app would make a request to fetch the data, which included the url for the cover photo image. Then, they needed to make a second request to fetch the image.</p><p>This is pretty standard, but they wanted to try to serve a small version of the image in the payload of the first request. They decided it should be smaller than 200 bytes for this to be worth it.</p><p>There was a problem, though. The headers of a JPEG image are larger of 200 bytes, but removing it they were close to 200 bytes. So they decided to use a common header for all images, which is stored in their client, and then only the JPEG data is returned.</p><p>Quite creative, right? In the path to solve the problem with loading images, we end up questioning the current formats and find work-arounds.</p><h4 id="Generating-tiny-thumbnails"><a href="#Generating-tiny-thumbnails" class="headerlink" title="Generating tiny thumbnails"></a>Generating tiny thumbnails</h4><p><em>More info on <a href="/webp-placeholder-images">Using WebP to create tiny preview images</a></em></p><p>I came across the article several months after it was posted. When I read it I wondered, how small can JPEG images be? I scaled down a few cover arts to 42x42 pixels, which is the size Facebook uses according to their post. And effectively, they were larger than their 200 Bytes budget.</p><p>Then I tried with other formats, like GIF and PNG, but they were even bigger. Until I tried with WebP, which resulted in roughly 1/4th of the size of the JPEG. One could say that the images are not exactly the same, and they are right. But once we apply a blur effect they look almost the same.</p><p>Regarding support for WebP, we should keep in mind that Facebook was trying to solve this for their mobile client. And there are libraries for rendering WebP on Android and iOS, so this seems a good solution.</p><h4 id="Getting-creative-with-SVGs"><a href="#Getting-creative-with-SVGs" class="headerlink" title="Getting creative with SVGs"></a>Getting creative with SVGs</h4><p><em>More info on <a href="/drawing-edges-svg">Using SVGs to achieve a cool drawing effect</a></em></p><p>Who doesn’t like SVGs? They are powerful and they can also be applied to image loading.</p><p>Some time ago I came across this site. It’s a review for the PS4 on Polygon.com. They use SVGs with an animation that looks like the image is being drawn.</p><p>Given a SVG it is easy to apply an animation of the stroke dash, as we see in this Spotify logo. On my quest to finding other ways to represent images, I thought of this technique. Sure thing, given a SVG we can “draw” it. But how can we apply this to bitmap images? Do we need to vectorize them?</p><p>It turns out we can draw the edges of an image. For that, we can detect the edges using an algorithm like Canny Edge. And the result is quite fun. The SVG is drawn and finally transitioned to the full image. We can detect edges, create polylines with SVG following those edges and apply the same technique we just saw to animate them.</p><p>The idea would be to pre-generate SVGs server-side, and inline them in the HTML. We have full control on how many lines to draw and the amount of detail. We can use a smaller version of the image to generate the points, still getting an accurate set of polylines. And the resulting SVG can be further optimized with svgo, and its size is around 2 or 3kB.</p><h4 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a>Conclusions</h4><p>Should we do this? I believe these techniques should be part of your toolbelt. The picture element is great for some applications, but we need to consider other scenarios like lazy-loading. Every approach has its advantages and disadvantages and we should use the more appropriate tool.</p><p>The Web is fun. You can right click and see the source code. The web is a great environment for anyone to learn. Go and experiment making your site faster.</p><p>Thanks!</p>]]></content>
    
    <summary type="html">
    
      I spoke at CSSConf AU 2016 in Melbourne about images on the web and what we can do to reduce their impact in our site&#39;s performance.
    
    </summary>
    
    
      <category term="images" scheme="https://jmperezperez.com/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>JPG compression level, SSIM and Jpeg.io</title>
    <link href="https://jmperezperez.com/ssim-jpeg-io/"/>
    <id>https://jmperezperez.com/ssim-jpeg-io/</id>
    <published>2016-10-14T15:43:00.000Z</published>
    <updated>2016-11-21T08:15:19.000Z</updated>
    
    <content type="html"><![CDATA[<p>The size of images in JPG varies a lot based on the compression level we choose when saving them. Often, we tweak this level by hand until we consider we don’t have too many artifacts and the resulting image is close enough to the original one.</p><p>The same compression level doesn’t generate the same amount of artifacts in two different images. We need to find an automated approach that measures how different (or similar) two images are, and loop through several compression levels to find the most suitable one.</p><a id="more"></a><h2 id="Structural-similarity"><a href="#Structural-similarity" class="headerlink" title="Structural similarity"></a>Structural similarity</h2><p>Some time ago I discovered <a href="https://github.com/technopagan/cjpeg-dssim" target="_blank" rel="external">cjpeg-ddsim</a> at <a href="/internetdagarna-2015/#High-Performance-Images-by-Tobias-Baldauf">a talk</a> by <a href="http://tobias.is/about/" target="_blank" rel="external">Tobias Baldauf</a> who works at Akamai and has written several tools for optimising images.</p><p><a href="https://en.wikipedia.org/wiki/Structural_similarity" target="_blank" rel="external">Structural similarity</a> is used for measuring the similarity between two images, which can be applied to our use case. Tobias himself has <a href="https://github.com/technopagan/adept-jpg-compressor" target="_blank" rel="external">a script</a> that goes through the whole process of applying SSIM to an image, though you will need to install some libraries to run it.</p><h2 id="ImageOptim-and-JPEG-io"><a href="#ImageOptim-and-JPEG-io" class="headerlink" title="ImageOptim and JPEG.io"></a>ImageOptim and JPEG.io</h2><p>I’m a big fan of automated tools like <a href="https://imageoptim.com" target="_blank" rel="external">ImageOptim</a>. Since I normally have full control on the assets of my projects, I can pass the images through it once and commit them optimised.</p><p>ImageOptim performs a <a href="/image-optimization-lossy-lossless-techniques">lossless optimisation</a> by default, removing EXIF data and preview images that are not needed. A lossy mode is available and can be enabled from the app’s preferences panel. Lossy presents the same problem, though. What compression level is the right one?</p><p><img src="/assets/images/posts/imageoptim-lossy.png" alt="Imageoptim&#39;s Preferences"></p><p>Reading <a href="http://frontendfocus.co/issues/261" target="_blank" rel="external">this week’s FrontEnd Focus (formerly HTML5 Weekly) newsletter</a> I found out about <a href="https://www.jpeg.io" target="_blank" rel="external">Jpeg.io</a>. This site claims to convert any image into a highly Optimized JPEG, so I decided to give it a try.</p><p>I run it through all JPG images on this blog, and I liked seeing that there were savings even though the images had already been optimised:</p><p><img src="/assets/images/posts/jpeg-io-results.png" alt="Jpeg.io results for some of the images of this blog"></p><p>Some images were left untouched, while others reduced their size as much as 70% (<a href="/assets/images/posts/spotify-hack-week-2014-presentation-before.jpg">before 236kB</a>, <a href="/assets/images/posts/spotify-hack-week-2014-presentation.jpg">after 71kB</a>).</p><h3 id="Progressive-JPEGs"><a href="#Progressive-JPEGs" class="headerlink" title="Progressive JPEGs"></a>Progressive JPEGs</h3><p>Another advantage is that it generates <a href="http://blog.patrickmeenan.com/2013/06/progressive-jpegs-ftw.html" target="_blank" rel="external">progressive JPGs</a>. Compared to baseline JPGs, progressive ones will render a larger area of the image earlier, though more <em>pixelated</em>. It provides a standard way to progressive load images without having to do something as fancy as <a href="/medium-image-progressive-loading-placeholder/">Medium’s technique</a>.</p><p>Note, however, that users might prefer baseline images, <a href="http://www.webperformancetoday.com/2014/09/17/progressive-image-rendering-good-evil/" target="_blank" rel="external">according to a study</a>, which was later <a href="http://conferences.oreilly.com/velocity/velocityny2014/public/schedule/detail/35658" target="_blank" rel="external">presented at Velocity</a>:</p><blockquote><p>When, as with the Progressive JPEG method, image rendition is a two-stage process in which an initially coarse image snaps into sharp focus, cognitive fluency is inhibited and the brain has to work slightly harder to make sense of what is being displayed</p></blockquote><h3 id="Customisation"><a href="#Customisation" class="headerlink" title="Customisation"></a>Customisation</h3><p>Jpeg.io doesn’t have any customisation options like image quality or compression. They don’t give too many details about the process they apply <a href="https://www.jpeg.io/about" target="_blank" rel="external">on their site</a>, but they do seem to do some kind of SSIM processing:</p><blockquote><p>Jpeg.io is a free online interface for rapidly and conveniently converting your images into highly optimized JPEGs using Kraken.io’s proprietary JPEG optimization algorithms. […] you’ll get a progressive JPEG compressed to the smallest possible size without perceptible quality loss.</p></blockquote><p>Kraken.io also offers <a href="https://kraken.io/web-interface" target="_blank" rel="external">an alternative web interface</a> where they do have some level of customisation, and show the percentage of savings per file.</p><h2 id="Future-of-SSIM-based-optimisation-tools"><a href="#Future-of-SSIM-based-optimisation-tools" class="headerlink" title="Future of SSIM-based optimisation tools"></a>Future of SSIM-based optimisation tools</h2><p>I do hope that we see more libraries that make use of image similarity and we can be easily used in our build pipelines and CMSs.</p>]]></content>
    
    <summary type="html">
    
      It&#39;s difficult to select the best compression level for JPG images. SSIM helps measuring image similarity, and tools like Jpeg.io makes it easier.
    
    </summary>
    
    
      <category term="images" scheme="https://jmperezperez.com/tags/images/"/>
    
  </entry>
  
  <entry>
    <title>How to lazy-load images to improve loading time and save bandwidth</title>
    <link href="https://jmperezperez.com/lazy-loading-images/"/>
    <id>https://jmperezperez.com/lazy-loading-images/</id>
    <published>2016-07-31T05:30:00.000Z</published>
    <updated>2017-01-02T10:21:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>tl;dr: Don’t load images that the user doesn’t see on screen. It is easier than you think.</p><a id="more"></a><h2 id="What-is-lazy-loading"><a href="#What-is-lazy-loading" class="headerlink" title="What is lazy loading"></a>What is lazy loading</h2><p>Everyone has seen lazy loading content on web sites and mobile apps. You start seeing some content, and as you scroll, more content gets loaded.</p><h2 id="A-web-page-and-all-its-requests"><a href="#A-web-page-and-all-its-requests" class="headerlink" title="A web page and all its requests"></a>A web page and all its requests</h2><p>In the case of web pages, it hasn’t been that easy for developers to find the balance between creating many small resources or serving a big one. A trend these days consist of inlining critical resources, the ones needed to render content above the fold, and load the rest of CSS and JS asynchronously. This is easy to do in small static sites, but more difficult for larger sites with dynamic content.</p><p>Delaying the request to some assets has lots of benefits:</p><ul><li>Less data usage for the user. This is especially important on mobile, where lots of users have poor network connections and restrictive data plans.</li><li>The server or CDN has to serve less data, which translates to a cheaper bill for the site.</li><li>Important content gets prioritised. The same bandwidth is used by fewer requests in parallel, so it is more likely that they are solved faster.</li><li>Less work for the browser. The browser doesn’t need to parse nor decode assets that are not requested.</li></ul><p>As with everything, this technique also comes with some disadvantages. Let’s focus on lazy loading of images.</p><h2 id="Lazy-loading-images"><a href="#Lazy-loading-images" class="headerlink" title="Lazy loading images"></a>Lazy loading images</h2><p>I will talk about how we can get big wins focusing on delaying the load of images.</p><p>We can have a quick look at <a href="https://spotify.com/" target="_blank" rel="external">spotify.com home page</a>:</p><video width="1194" height="798" controls><source src="/assets/images/posts/spotify-com-loading-images.webm" type="video/webm"><source src="/assets/images/posts/spotify-com-loading-images.mp4" type="video/mp4"></video><p>We load the page, then clear the network tab, which is filtered to show only requests for images. As we scroll down the page, more images are requested, accounting for ~1.1MB.</p><p>Lazy loading images gives full control to select what image needs to be loaded (eg a 2x version for a retina display, or a 1x when in slower connections). It is also possible to create smooth transitions of opacity or blurriness to create nice effects. I recommend you to read <a href="/medium-image-progressive-loading-placeholder/">a previous post about progressive image rendering</a> to see some examples.</p><p>Despite is advantages, this technique also has its drawbacks.</p><h2 id="Drawbacks-of-lazy-loading-images"><a href="#Drawbacks-of-lazy-loading-images" class="headerlink" title="Drawbacks of lazy loading images"></a>Drawbacks of lazy loading images</h2><h3 id="JavaScript-based"><a href="#JavaScript-based" class="headerlink" title="JavaScript based"></a>JavaScript based</h3><p>So far, browsers don’t support a native way of marking a certain image to be lazy loaded. The solutions are JavaScript-based, which means that it won’t work if the browser has JS disabled or the request for the JS snippet fails.</p><p><a href="https://gds.blog.gov.uk/2013/10/21/how-many-people-are-missing-out-on-javascript-enhancement/" target="_blank" rel="external">This is not so unlikely</a>, and content-blockers are becoming more widespread used, both on desktop and mobile. For JS disabled browsers, it is possible to implement a fallback using <code>&lt;noscript&gt;</code>, although this won’t work if the browser uses some kind of content blocker for JS files.</p><h3 id="Scroll-listeners-and-relayouts"><a href="#Scroll-listeners-and-relayouts" class="headerlink" title="Scroll listeners and relayouts"></a>Scroll listeners and relayouts</h3><p>When doing lazy load, we want to detect when the page is scrolled, and then check whether the placeholder for our image is within the rendered section of the page. And this needs to be performed for all the images we want to lazy load.</p><p>Scroll listeners can have a negative impact in scrolling performance. During the scroll movement, the browser triggers many scroll events, and finding out the position and dimension of our images causes <a href="https://gist.github.com/paulirish/5d52fb081b3570c81e3a" target="_blank" rel="external">a layout recalculation</a>. This is an expensive operation that makes the browser spend too long drawing frames, producing <a href="http://jankfree.org/" target="_blank" rel="external">stuttering when scrolling</a>.</p><p>To avoid it, JS developers usually cache dimensions and positions of some elements, and use throttling and debouncing to execute the scroll callback fewer times.</p><h4 id="IntersectionObserver"><a href="#IntersectionObserver" class="headerlink" title="IntersectionObserver"></a>IntersectionObserver</h4><p>There is an experimental API called <a href="https://developers.google.com/web/updates/2016/04/intersectionobserver" target="_blank" rel="external">IntersectionObserver</a> that suits very well this use case. Instead of subscribing to the scroll event, and then go through the lazy-loaded images, IntersectionObserver allows us to subscribe to an event triggered when the image enters the rendered area (viewport).</p><p><img src="/assets/images/posts/intersectionobserver.gif" alt="IntersectionObserver"> <em>Source: <a href="https://developers.google.com/web/updates/2016/04/intersectionobserver" target="_blank" rel="external">IntersectionObserver’s Coming into View</a>.</em></p><p>The API is fully supported on Chrome, Opera and MS Edge. It’s <a href="http://caniuse.com/intersectionobserver" target="_blank" rel="external">also enabled in Firefox</a>, behind the <code>dom.IntersectionObserver.enabled</code> preference.</p><p>IntersectionObserver has also other interesting applications. The main one is probable a more fine control on ads, to make sure impressions are tracked for ads that the user actually sees. Another one is infinite scrolling lists, that can be implemented as sets of <em>pages</em> (top, current, bottom) that we can listen to for visibility events and load/unload rows or change the height of the pages.</p><h3 id="Fallback-content-and-viewport"><a href="#Fallback-content-and-viewport" class="headerlink" title="Fallback content and viewport"></a>Fallback content and viewport</h3><p>When an image is displayed within the rendered area, we know it needs to be fetched. But we could also fetch it when, not being strictly within the rendered area, it is very close to it. This reduces the likeliness that a placeholder is rendered without its image, but can also mean requesting images that will never be displayed.</p><p>Finally, we need to think of what will be rendered in the placeholder while the images are fetched. A possibility is to show an empty area. Why not an area filled with a dominant colour? You can revisit <a href="/medium-image-progressive-loading-placeholder/">the post about progressive image rendering</a> to get some ideas.</p><h3 id="Browser-limitations"><a href="#Browser-limitations" class="headerlink" title="Browser limitations"></a>Browser limitations</h3><p>Some browsers may limit how much work is done while scrolling. WebKit on iOS 7 scroll event change <a href="http://developer.telerik.com/featured/scroll-event-change-ios-8-big-deal/" target="_blank" rel="external">used to be fired when the scroll gesture stopped</a>, making it impossible to load. Fortunately, most used browsers today don’t present this limitation.</p><h2 id="An-example-Spotify-Open-pages"><a href="#An-example-Spotify-Open-pages" class="headerlink" title="An example: Spotify Open pages"></a>An example: Spotify Open pages</h2><p>The <a href="https://open.spotify.com/" target="_blank" rel="external">Spotify’s Open site</a>, where it shows information about Spotify catalogue, have been using lazy loading for the images for more than a year. Let’s use <a href="https://open.spotify.com/track/7oSUp4yZ0FbuSvVmCxH2ty?noredir=1" target="_blank" rel="external">a track page</a> as an example.</p><p>The main goal of the page is for the user to have information about the track, and click the Call to Action button (green button) to open the track in a Spotify client or sign up. That’s why it’s crucial that these elements are shown above the fold.</p><p>The main image is not lazy loaded. Doing so would delay its rendering since the browser would need to first parse and execute the JS code that does the lazy loading, and then the image would be requested. However, the rest of the images below the fold, like the ones showing more albums by the same artist, don’t need to be fetched until the user scrolls down and they enter the screen. <img src="/assets/images/posts/open-pages-structure.png" alt="Structure of a Spotify Open page."></p><p>The Open site uses a small library that provides lazy loading. Due to its small size, it can also be inlined in the markup, so there is no need to make a request for the script and images are requested a bit earlier.</p><p>Instead of using the src attribute of an <code>&lt;img/&gt;</code> to point to the image file, we use data-src. We can also add 2x versions of the images, that will get loaded if the browser screen is a retina display.</p><p>Internally, the library makes sure the scrolling performance is not affected when using lazy load. It uses passive event listeners, throttles scroll events, caches image dimensions, and don’t process images already loaded. Finally, it uses IntersectionObserver on supported browsers, avoiding listening to the scroll event and asking for properties from the images.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>When building a website, consider lazy loading the assets when they are needed. This is both good for the user and the site’s servers and CDNs.</p>]]></content>
    
    <summary type="html">
    
      When building a website, consider lazy loading the assets when they are needed. This post will focus in the specific case of lazy loading images.
    
    </summary>
    
    
      <category term="images" scheme="https://jmperezperez.com/tags/images/"/>
    
      <category term="lazy-loading" scheme="https://jmperezperez.com/tags/lazy-loading/"/>
    
  </entry>
  
  <entry>
    <title>Some things I learned implementing Data Fetching for Universal Web Apps</title>
    <link href="https://jmperezperez.com/data-fetching-universal-apps/"/>
    <id>https://jmperezperez.com/data-fetching-universal-apps/</id>
    <published>2016-07-16T15:40:00.000Z</published>
    <updated>2016-11-21T08:15:32.000Z</updated>
    
    <content type="html"><![CDATA[<p>Javascript is not just a language for the browser. Node.JS is becoming popular as a platform to run JS on the server. We are learning how to build modular websites where business logic and state are not coupled with the markup. And finally we are getting the tools to build universal web apps. But what are universal apps, and why should we care about data fetching?</p><a id="more"></a><h2 id="Universal-Isomorphic-apps"><a href="#Universal-Isomorphic-apps" class="headerlink" title="Universal/Isomorphic apps"></a>Universal/Isomorphic apps</h2><p>The community hasn’t decided on what to call them yet, but for the sake of consistency I’ll be referring to them as <em>universal</em> web apps. These projects have 2 main features:</p><ul><li>The server runs JS</li><li>Most of the code of the project is shared between browser and server.</li></ul><p>For a long time we tangled business logic with markup. We would generate some HTML in the server and JS would run in the client to make AJAX requests and changes in the DOM.</p><p>This worked for most websites, but today lots of projects start as a SPA. Their state is managed in a single place and the server just provides the initial page and a set of endpoints that return data to the view. But this approach has caused <a href="https://blog.twitter.com/2012/improving-performance-on-twittercom" target="_blank" rel="external">long page load times</a> and bad SEO forced rethinking the web.</p><p>The best way to provide fast-loading pages is to server-side render them. Though service workers might help eventually, the initial request needs to reach the server. To compose the page, the server needs to identify the user, fetch some data and generate the markup through some template system. After the initial load, JS comes in and replaces full page loads with some data fetching and markup composition.</p><p>Here we can see that some code will be duplicated, especially in SPAs. A way to improve this is by running JS in the server and trying to write code that is decoupled from the DOM. Server-side rendering can be seen these days as an enhancement for SPAs.</p><h2 id="Data-fetching-in-universal-apps"><a href="#Data-fetching-in-universal-apps" class="headerlink" title="Data fetching in universal apps"></a>Data fetching in universal apps</h2><p>In universal apps, most of the code can be shared between browser and server. One of the pieces that differs is data fetching. Node.JS has its own way to make requests, and neither <code>XMLHttpRequest</code> nor <code>fetch</code> is supported. <img src="/assets/images/posts/universal-data-fetching.png" alt="Universal request libraries abstract your code from how a request is made."></p><p>There exists many libraries that will perform the async requests using the mechanism available in the platform running the code. Some of them try to polyfill <code>fetch</code> in Node, others polyfill <code>http</code> in the browser. In our code we <code>require</code>/<code>import</code> them, and then the code is included in the bundle served to the browser using browserify or webpack.</p><h3 id="Choosing-a-universal-request-package"><a href="#Choosing-a-universal-request-package" class="headerlink" title="Choosing a universal request package"></a>Choosing a universal request package</h3><p>Regardless of which request library one you choose, <strong>be aware of how they contribute to the bundle size</strong>. Ideally, these libraries should represent a rather small chunk of the bundle, but I have been doing some tests and the results are pretty interesting.</p><p>I have used browserify to create a bundle just requiring each of there libraries separately, and then uglified the output. The size shown is minified, not gzipped:</p><ul><li><a href="https://github.com/jedmao/iso-http" target="_blank" rel="external">iso-http 0.0.5</a>: 4kB</li><li><a href="https://github.com/matthew-andrews/isomorphic-fetch" target="_blank" rel="external">isomorphic-fetch 2.2.1</a>: 9kB</li><li><a href="https://github.com/visionmedia/superagent" target="_blank" rel="external">superagent 2.0.0</a>: 9kB</li><li><a href="https://github.com/mzabriskie/axios" target="_blank" rel="external">axios 0.13.0</a>: 20kB</li><li><a href="https://registry.npmjs.org/isomorphic-request" target="_blank" rel="external">isomorphic-request 1.0.0</a>: 240kB</li><li><a href="https://github.com/bitinn/node-fetch" target="_blank" rel="external">node-fetch 1.5.3</a>: 489kB</li></ul><p>Note that these packages might not have the same features, and I haven’t tried most of them myself. In some cases it might be worth creating your custom request library accesses the endpoints you are using. But all in all these libraries should generate code that wraps <code>XMLHttpRequest</code> and its response.</p><p>Notice the big difference in size between them, all the way from 4kB to 489kB. How can that be? For that we need to understand what is going on when our code is bundled.</p><h3 id="Bundling-of-Node’s-APIs"><a href="#Bundling-of-Node’s-APIs" class="headerlink" title="Bundling of Node’s APIs"></a>Bundling of Node’s APIs</h3><p>Something I learnt while creating those bundles is that it is very useful to double check the generated code. <strong>If the required code includes some feature only available in Node, the bundler will add the JS code for it in the output bundle.</strong></p><p>An example is <code>Buffer</code>, which <a href="https://github.com/thelinmichael/spotify-web-api-node/blob/cf9b5834b828b38b659afd82fb85ae742d5ea0eb/src/spotify-web-api.js#L1241" target="_blank" rel="external">I was using in a wrapper for the Spotify Web API</a>. Since <code>Buffer</code> is not supported in the browser environment, which accounts to 44kB of JS (minified).</p><p>Same thing can happen with these request libraries when they include code that is supposed to be only run in Node.JS and not on the browser.</p><h3 id="The-browser-field"><a href="#The-browser-field" class="headerlink" title="The browser field"></a>The <code>browser</code> field</h3><p>When you are bundling some JS code that is going to be run only on the server, do not include it in the bundle that is going to be run on the browser. This applies both if you are writing a site and if you are writing a library that will be used by another project.</p><p>For this, use the <a href="https://github.com/defunctzombie/package-browser-field-spec" target="_blank" rel="external"><code>browser</code> field</a> in the <code>package.json</code> file. It is used, amongst others, to define what file needs to be replaced by other when bundling. When using webpack, make sure <a href="https://webpack.github.io/docs/configuration.html#target" target="_blank" rel="external"><code>target</code></a> is not set or set to <code>&#39;web&#39;</code>.</p><p>You can see an example <a href="https://github.com/visionmedia/superagent/blob/83892f35fe15676a4567a0eb51eecd096939ad36/package.json#L54" target="_blank" rel="external">in the superagent source code</a>:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"superagent"</span>,</div><div class="line">  ...</div><div class="line">  <span class="string">"browser"</span>: &#123;</div><div class="line">    <span class="string">"./lib/node/index.js"</span>: <span class="string">"./lib/client.js"</span>,</div><div class="line">    ...</div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">  <span class="string">"main"</span>: <span class="string">"./lib/node/index.js"</span>,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>or <a href="https://github.com/jedmao/iso-http/blob/33870ab0ee79d93e73ad55d787c99c5f5e07f936/package.json#L6" target="_blank" rel="external">iso-http</a>:</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"name"</span>: <span class="string">"iso-http"</span>,</div><div class="line">  ...</div><div class="line">  <span class="string">"main"</span>: <span class="string">"js/node/Http.js"</span>,</div><div class="line">  <span class="string">"browser"</span>: <span class="string">"js/browser/Http.js"</span>,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>From the libraries I tested, 4 of them were using <code>browser</code> and 2 of them not. These 2 are precisely the ones that generate the largest bundle files.</p><h3 id="Getting-stats-about-a-bundle"><a href="#Getting-stats-about-a-bundle" class="headerlink" title="Getting stats about a bundle"></a>Getting stats about a bundle</h3><p>It is not straightforward to know what modules are contributing the most size to the output bundle. One way you can try is by creating an entry JS file that only includes the module you are interested in, which is what I did when comparing request libraries. But if you are using webpack, a better way is to use <a href="https://github.com/chrisbateman/webpack-visualizer" target="_blank" rel="external">webpack-visualizer</a>.</p><p>This tool generates a pie chart with all the required dependencies and makes it straightforward to find the culprit. <img src="/assets/images/posts/node-fetch-webpack-stats.png" alt="iconv-lite and pako are the main contributors to node-fetch bundle size"> <em>^ iconv-lite and pako are the main contributors to node-fetch bundle size</em></p><h3 id="One-more-thing-ES6-imports"><a href="#One-more-thing-ES6-imports" class="headerlink" title="One more thing: ES6 imports"></a>One more thing: ES6 imports</h3><p>A great way to reduce the footprint of a library is by exporting it in pieces. Thanks to ES6 and tree-shaking, one can import a subset of functions and symbols from a library, which can reduce largely the size of the output bundle.</p><p>This is really useful if you are implementing a wrapper for your API endpoints. It is convenient to support all the endpoints, but an app might only be interesting in using a few of those.</p><p>I have started experimenting with this building <a href="https://github.com/JMPerez/spotify-web-api-js-poc" target="_blank" rel="external">a new wrapper for the Spotify Web API</a> that exposes each endpoint as an exported function, so that the unused endpoints are not part of the generated code.</p><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Universal apps are great, and so is sharing lots of code between server and client. As important as a fast rendering time is the time it takes the browser to download, parse and execute the JS that provides the client-side functionality. Keep an eye on your imports, and prevent including code that is not intended to be run on the browser.</p>]]></content>
    
    <summary type="html">
    
      Webpack and Browserify generate large bundles if we include Node.JS code to be run on the browser. In this post you will learn how to prevent this issue.
    
    </summary>
    
    
      <category term="isomorphic" scheme="https://jmperezperez.com/tags/isomorphic/"/>
    
      <category term="universal" scheme="https://jmperezperez.com/tags/universal/"/>
    
      <category term="webpack" scheme="https://jmperezperez.com/tags/webpack/"/>
    
      <category term="browserify" scheme="https://jmperezperez.com/tags/browserify/"/>
    
      <category term="node" scheme="https://jmperezperez.com/tags/node/"/>
    
  </entry>
  
  <entry>
    <title>The importance of personal side projects</title>
    <link href="https://jmperezperez.com/personal-projects/"/>
    <id>https://jmperezperez.com/personal-projects/</id>
    <published>2016-04-05T16:05:00.000Z</published>
    <updated>2016-11-21T08:15:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>This blog you are reading is more a tool for me to consolidate some ideas and experiences I come across. So is <a href="https://github.com/JMPerez" target="_blank" rel="external">my GitHub account</a>, where I upload some small projects that otherwise would remain on my computer and eventually die. It is also a way of <em>giving back</em>: I have learned may things reading other people’s posts and code, and I hope someone can find what I do useful.</p><a id="more"></a><p>Posting my code on GitHub also forces me to improve its readability, documentation and testability. They are an opportunity to test build tools, libraries &amp; frameworks and different ways of structuring a web project. They help me get a grasp of the implications of picking one tool over the other in applications larger than a “Hello World”, and I can make more informed decisions on what to use when I am faced with a real project at work.</p><h2 id="A-practical-case"><a href="#A-practical-case" class="headerlink" title="A practical case"></a>A practical case</h2><p>I was involved in the implementation of a web site that needed to be live in less than one week. Fortunately I could put together pieces of several side projects and meet the deadline. I used file drag &amp; drop from a project, JS-based unzipping from another one, a wrapper for the Spotify Web API, a throttler for promises and the build tools and general structure of the website from another one. All of them pet projects that I decided to tidy up a bit and put at reach.</p><p>I learned that not only side projects are useful as a way to experiment, give back and build a portfolio, but also as components of a toolbelt that can be very handy when the occasion presents itself.</p><h2 id="Do-it"><a href="#Do-it" class="headerlink" title="Do it"></a>Do it</h2><p>Even if you think that you don’t have anything useful to share with the world, open-source your projects or become a contributor of a project you like. These are really exciting times and it’ ha’s never been that easy to collaborate.</p>]]></content>
    
    <summary type="html">
    
      Side projects are fun, and they will add value to your daily work when it is most needed.
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Spotify&#39;s new brand identity using feColorMatrix SVG filters</title>
    <link href="https://jmperezperez.com/duotone-using-fecolormatrix/"/>
    <id>https://jmperezperez.com/duotone-using-fecolormatrix/</id>
    <published>2016-02-14T10:40:00.000Z</published>
    <updated>2016-11-21T08:16:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>This is a short post where I show how to use SVG and a <code>feColorMatrix</code> filter to apply a duotone effect to an image.</p><a id="more"></a><p>Demo &amp; Code: <a href="http://codepen.io/jmperez/pen/LGqaxQ" target="_blank" rel="external">http://codepen.io/jmperez/pen/LGqaxQ</a></p><p>You may have seen that the <a href="http://www.fastcodesign.com/3043547/spotifys-new-look-signals-its-identity-shift" target="_blank" rel="external">Spotify’s new brand identity</a> is full of duotone images. My colleague Thodoris described how to achieve this effect <a href="http://blog.72lions.com/blog/2015/7/7/duotone-in-js" target="_blank" rel="external">in JS</a> and <a href="http://blog.72lions.com/blog/2015/7/18/duotone-in-ios" target="_blank" rel="external">in iOS</a>.</p><p>The JS version uses <code>&lt;canvas&gt;</code>, and after reading <a href="http://alistapart.com/article/finessing-fecolormatrix" target="_blank" rel="external">A List Apart’s Finessing feColorMatrix</a>, where they also mention the duotone images used in <a href="https://yearinmusic.spotify.com" target="_blank" rel="external">Spotify’s Year in Music</a>, I forked <a href="http://codepen.io/72lions/pen/jPzLJX" target="_blank" rel="external">Thodoris’ pen</a> and used <code>feColorMatrix</code> instead:</p><p></p><p data-height="367" data-theme-id="0" data-slug-hash="LGqaxQ" data-default-tab="result" data-user="jmperez" class="codepen">See the Pen <a href="http://codepen.io/jmperez/pen/LGqaxQ/" target="_blank" rel="external">Duotone effect (Spotify Duotone) - Using feColumnMatrix</a> by José Manuel Pérez (<a href="http://codepen.io/jmperez" target="_blank" rel="external">@jmperez</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p><script async src="//assets.codepen.io/assets/embed/ei.js"></script><p>The code consists of a <code>&lt;svg/&gt;</code> that has an <code>&lt;image/&gt;</code> to which we apply a <code>&lt;filter /&gt;</code>. The filter uses a <code>feColorMatrix</code>, and its values are calculated using JS, though if you already know the range of colours you want to apply there is no need to run JS, just set them in the markup. If you have any issues understanding how the matrix is calculated, check <a href="http://stackoverflow.com/questions/21977929/match-colors-in-fecolormatrix-filter" target="_blank" rel="external">this question on StackOverflow</a>.</p>]]></content>
    
    <summary type="html">
    
      Using feColorMatrix SVG filters to apply a duotone effect to an image.
    
    </summary>
    
    
      <category term="svg" scheme="https://jmperezperez.com/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>SVG Optimisation using SVGOMG and FontForge</title>
    <link href="https://jmperezperez.com/optimising-svgs/"/>
    <id>https://jmperezperez.com/optimising-svgs/</id>
    <published>2016-01-30T07:40:00.000Z</published>
    <updated>2016-11-21T08:16:11.000Z</updated>
    
    <content type="html"><![CDATA[<p><style>.language-xml{white-space: normal}</style>Lots of websites have started replacing their icon fonts and small icons with SVGs. They support CSS manipulations, animations and are great for responsive sites. But it is important to keep an eye on their size.</p><a id="more"></a><h2 id="How-SVGs-are-included-in-a-page"><a href="#How-SVGs-are-included-in-a-page" class="headerlink" title="How SVGs are included in a page"></a>How SVGs are included in a page</h2><p>Since the SVGs are usually small in size, lots of developers decide to inline them. Especially when replacing a web icon font, which can be fetch in a single request.</p><p>Some sites inline the SVGs as part of their CSS file. This can be done uri-encoding the SVG data, or converting it to base 64, but <a href="https://css-tricks.com/probably-dont-base64-svg/" target="_blank" rel="external">this one results in a larger payload</a>. <a href="/assets/images/posts/svg-inline-html-use.png"><img src="/assets/images/posts/svg-inline-html-use.png" alt="Including SVGs in the markup"></a></p><p>Some other sites include them as part of the markup, defining them as <code>&lt;symbol /&gt;</code>s, and adding a reference to them where they should be rendered through the <code>&lt;use /&gt;</code> tag. I like this one because it is easier to just serve the SVGs used in that page. If you use this, remember to define the symbols above the reference to them, or some browsers (e.g. Safari on iPhone) will not render the SVGs. <a href="/assets/images/posts/svg-inline-css.png"><img src="/assets/images/posts/svg-inline-css.png" alt="Including SVGs inlined in the CSS"></a></p><p>In any case, the SVGs are making their way to the critical path, and saving bytes won’t result in a worse experience.</p><h2 id="Next-step-optimise-the-SVGs"><a href="#Next-step-optimise-the-SVGs" class="headerlink" title="Next step, optimise the SVGs"></a>Next step, optimise the SVGs</h2><p>So far we have our SVGs on the page and they are rendered. SVGs are text-based and they compress really well. However, there is normally room for improvement and we can shave some bytes using an optimiser.</p><p>If you have used ImageOptim to optimise bitmap images, then you will love this one. <a href="https://jakearchibald.github.io/svgomg/" target="_blank" rel="external">SVGOMG</a> is a website where you drag&amp;drop your SVG and get an optimised version. It uses <a href="https://github.com/svg/svgo" target="_blank" rel="external">svgo</a>, which you can also use from the console or as part of your build process.</p><p>SVGO will optimise paths and merge layers. If you want to be able to open the optimised SVG and edit in in some tool like Inkscape, remember to save the original one somewhere else.</p><h2 id="Going-beyond-more-optimisations"><a href="#Going-beyond-more-optimisations" class="headerlink" title="Going beyond, more optimisations"></a>Going beyond, more optimisations</h2><p>If you have read this far, you will welcome ideas to further optimise your SVGs. A few weeks ago I came across a series of posts by <a href="https://twitter.com/larsenwork" target="_blank" rel="external">Andreas Larsen</a> on Medium that I strongly recommend checking out:</p><ul><li><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-1-67e8f2d4035#.2bnvih6cw" target="_blank" rel="external">Optimising SVGs for Web Use - Part 1</a></li><li><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-2-6711cc15df46#.al4v73web" target="_blank" rel="external">Optimising SVGs for Web Use - Part 2</a></li><li><a href="https://medium.com/larsenwork-andreas-larsen/optimising-svgs-for-web-use-part-2-1-598815d74f9c#.rv7i93abh" target="_blank" rel="external">Optimising SVGs for Web Use - Part 2½</a></li></ul><p>Optimising SVGs “by hand” might look a bit tedious and only at reach of a few ones, but the gains are big.</p><h2 id="An-example-Spotify-logo"><a href="#An-example-Spotify-logo" class="headerlink" title="An example: Spotify logo"></a>An example: Spotify logo</h2><p>I decided to try to use some of Andreas’ ideas and try to optimise the Spotify logo.</p><p><a href="/assets/images/posts/spotify-fontforge.png"><img src="/assets/images/posts/spotify-fontforge.png" alt="Editing the Spotify logo in fontForge"></a></p><p>This is what I did:</p><ol><li>Install fontForge: I had to install X11 and then fontForge. fontForge can be used to create and edit fonts, so the grid and rules have been thought for that use case. Still, it can be used for a regular SVG.</li><li>Import the SVG that you want to optimise.</li><li>Scale it up using Element &gt; Transformations &gt; Transform. We will be rounding the values to integers, so try to find a multiplier that will reduce the <em>error</em> when rounding. Rounding the numbers means that we remove the decimal part, but be careful not to scale the SVG up a lot, or the integer part will also grow.</li><li>Simplify the path using <code>Element &gt; Simplify &gt; Simplify</code>. If you see some path being oversimplified, undo and simplify the rest.</li><li>Round to integer using <code>Element &gt; Round &gt; To Int</code>.</li><li>In my case, I had to tweak the position of the SVG. It might be because I was using wrong values for ascent, descent, underline and height. You can use <code>Element &gt; Font Info &gt; General</code> to modify these values.</li><li>Export it as SVG.</li><li>Open <a href="https://jakearchibald.github.io/svgomg/" target="_blank" rel="external">SVGOMG</a>, import the resulting SVG and download the optimised one.</li></ol><p>In my case it went down from 2.24kB to 915 bytes, both compressed as reported by SVGOMG.</p><p>Original:</p><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">id</span>=<span class="string">"Layer_1"</span> <span class="attr">style</span>=<span class="string">"enable-background:new 0 0 566.93 170.04"</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">xml:space</span>=<span class="string">"preserve"</span> <span class="attr">viewBox</span>=<span class="string">"0 0 566.93 170.04"</span> <span class="attr">version</span>=<span class="string">"1.1"</span> <span class="attr">y</span>=<span class="string">"0px"</span> <span class="attr">x</span>=<span class="string">"0px"</span> <span class="attr">xmlns:xlink</span>=<span class="string">"http://www.w3.org/1999/xlink"</span> <span class="attr">width</span>=<span class="string">"567"</span> <span class="attr">height</span>=<span class="string">"171"</span> <span class="attr">fill</span>=<span class="string">"#000000"</span>&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m87.996 1.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.254 37.494 83.745 83.743 83.745 46.251 0 83.743-37.491 83.743-83.745 0-46.246-37.49-83.738-83.744-83.738zm38.404 120.78c-1.504 2.467-4.718 3.24-7.177 1.737-19.665-12.019-44.417-14.734-73.567-8.075-2.809 0.644-5.609-1.117-6.249-3.925-0.643-2.809 1.11-5.609 3.926-6.249 31.9-7.293 59.263-4.154 81.336 9.334 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.799c-1.894 3.073-5.912 4.037-8.981 2.15-22.505-13.834-56.822-17.841-83.447-9.759-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.221-4.758 94.071 11.127 3.07 1.89 4.04 5.91 2.15 8.976zm0.88-23.744c-26.994-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.722 2.209 4.943 7.016 2.737 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m232.09 78.586c-14.459-3.448-17.033-5.868-17.033-10.953 0-4.804 4.523-8.037 11.249-8.037 6.52 0 12.985 2.455 19.763 7.509 0.205 0.153 0.462 0.214 0.715 0.174 0.253-0.038 0.477-0.177 0.625-0.386l7.06-9.952c0.29-0.41 0.211-0.975-0.18-1.288-8.067-6.473-17.151-9.62-27.769-9.62-15.612 0-26.517 9.369-26.517 22.774 0 14.375 9.407 19.465 25.663 23.394 13.836 3.187 16.171 5.857 16.171 10.63 0 5.289-4.722 8.577-12.321 8.577-8.44 0-15.324-2.843-23.025-9.512-0.191-0.165-0.453-0.24-0.695-0.226-0.255 0.021-0.488 0.139-0.65 0.334l-7.916 9.421c-0.332 0.391-0.29 0.975 0.094 1.313 8.96 7.999 19.98 12.224 31.872 12.224 16.823 0 27.694-9.192 27.694-23.419 0.03-12.01-7.16-18.66-24.77-22.944z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m294.95 64.326c-7.292 0-13.273 2.872-18.205 8.757v-6.624c0-0.523-0.424-0.949-0.946-0.949h-12.947c-0.523 0-0.946 0.426-0.946 0.949v73.602c0 0.523 0.423 0.949 0.946 0.949h12.947c0.522 0 0.946-0.426 0.946-0.949v-23.233c4.933 5.536 10.915 8.241 18.205 8.241 13.549 0 27.265-10.43 27.265-30.368 0.02-19.943-13.7-30.376-27.25-30.376zm12.21 30.375c0 10.153-6.254 17.238-15.209 17.238-8.853 0-15.531-7.407-15.531-17.238 0-9.83 6.678-17.238 15.531-17.238 8.81-0.001 15.21 7.247 15.21 17.237z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m357.37 64.326c-17.449 0-31.119 13.436-31.119 30.592 0 16.969 13.576 30.264 30.905 30.264 17.511 0 31.223-13.391 31.223-30.481 0-17.031-13.62-30.373-31.01-30.373zm0 47.714c-9.281 0-16.278-7.457-16.278-17.344 0-9.929 6.755-17.134 16.064-17.134 9.341 0 16.385 7.457 16.385 17.351 0 9.927-6.8 17.127-16.17 17.127z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m425.64 65.51h-14.247v-14.566c0-0.522-0.422-0.948-0.945-0.948h-12.945c-0.524 0-0.949 0.426-0.949 0.948v14.566h-6.225c-0.521 0-0.943 0.426-0.943 0.949v11.127c0 0.522 0.422 0.949 0.943 0.949h6.225v28.791c0 11.635 5.791 17.534 17.212 17.534 4.644 0 8.497-0.959 12.128-3.018 0.295-0.165 0.478-0.483 0.478-0.821v-10.596c0-0.327-0.17-0.636-0.45-0.807-0.282-0.177-0.633-0.186-0.922-0.043-2.494 1.255-4.905 1.834-7.6 1.834-4.154 0-6.007-1.886-6.007-6.113v-26.756h14.247c0.523 0 0.944-0.426 0.944-0.949v-11.126c0.02-0.523-0.4-0.949-0.93-0.949z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m475.28 65.567v-1.789c0-5.263 2.018-7.61 6.544-7.61 2.699 0 4.867 0.536 7.295 1.346 0.299 0.094 0.611 0.047 0.854-0.132 0.25-0.179 0.391-0.466 0.391-0.77v-10.91c0-0.417-0.268-0.786-0.67-0.909-2.565-0.763-5.847-1.546-10.761-1.546-11.958 0-18.279 6.734-18.279 19.467v2.74h-6.22c-0.522 0-0.95 0.426-0.95 0.948v11.184c0 0.522 0.428 0.949 0.95 0.949h6.22v44.409c0 0.523 0.422 0.949 0.944 0.949h12.947c0.523 0 0.949-0.426 0.949-0.949v-44.406h12.088l18.517 44.398c-2.102 4.665-4.169 5.593-6.991 5.593-2.281 0-4.683-0.681-7.139-2.025-0.231-0.127-0.505-0.148-0.754-0.071-0.247 0.087-0.455 0.271-0.56 0.511l-4.388 9.627c-0.209 0.455-0.03 0.989 0.408 1.225 4.581 2.481 8.716 3.54 13.827 3.54 9.56 0 14.844-4.453 19.502-16.433l22.461-58.04c0.113-0.292 0.079-0.622-0.1-0.881-0.178-0.257-0.465-0.412-0.779-0.412h-13.478c-0.404 0-0.765 0.257-0.897 0.636l-13.807 39.438-15.123-39.464c-0.138-0.367-0.492-0.61-0.884-0.61h-22.12z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m446.5 65.51h-12.947c-0.523 0-0.949 0.426-0.949 0.949v56.485c0 0.523 0.426 0.949 0.949 0.949h12.947c0.522 0 0.949-0.426 0.949-0.949v-56.481c0-0.523-0.42-0.949-0.95-0.949z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m440.1 39.791c-5.129 0-9.291 4.152-9.291 9.281 0 5.132 4.163 9.289 9.291 9.289 5.127 0 9.285-4.157 9.285-9.289 0-5.128-4.16-9.281-9.28-9.281z"</span>/&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">d</span>=<span class="string">"m553.52 83.671c-5.124 0-9.111-4.115-9.111-9.112s4.039-9.159 9.159-9.159c5.124 0 9.111 4.114 9.111 9.107 0 4.997-4.04 9.164-9.16 9.164zm0.05-17.365c-4.667 0-8.198 3.71-8.198 8.253 0 4.541 3.506 8.201 8.151 8.201 4.666 0 8.201-3.707 8.201-8.253 0-4.541-3.51-8.201-8.15-8.201zm2.02 9.138l2.577 3.608h-2.173l-2.32-3.31h-1.995v3.31h-1.819v-9.564h4.265c2.222 0 3.683 1.137 3.683 3.051 0.01 1.568-0.9 2.526-2.21 2.905zm-1.54-4.315h-2.372v3.025h2.372c1.184 0 1.891-0.579 1.891-1.514 0-0.984-0.71-1.511-1.89-1.511z"</span>/&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div></pre></td></tr></table></figure><p>Optimised:</p><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">"http://www.w3.org/2000/svg"</span> <span class="attr">width</span>=<span class="string">"1134"</span> <span class="attr">height</span>=<span class="string">"340"</span>&gt;</span><span class="tag">&lt;<span class="name">path</span> <span class="attr">fill</span>=<span class="string">"%23fff"</span> <span class="attr">d</span>=<span class="string">"M8 171c0 92 76 168 168 168s168-76 168-168S268 4 176 4 8 79 8 171zm230 78c-39-24-89-30-147-17-14 2-16-18-4-20 64-15 118-8 162 19 11 7 0 24-11 18zm17-45c-45-28-114-36-167-20-17 5-23-21-7-25 61-18 136-9 188 23 14 9 0 31-14 22zM80 133c-17 6-28-23-9-30 59-18 159-15 221 22 17 9 1 37-17 27-54-32-144-35-195-19zm379 91c-17 0-33-6-47-20-1 0-1 1-1 1l-16 19c-1 1-1 2 0 3 18 16 40 24 64 24 34 0 55-19 55-47 0-24-15-37-50-46-29-7-34-12-34-22s10-16 23-16 25 5 39 15c0 0 1 1 2 1s1-1 1-1l14-20c1-1 1-1 0-2-16-13-35-20-56-20-31 0-53 19-53 46 0 29 20 38 52 46 28 6 32 12 32 22 0 11-10 17-25 17zm95-77v-13c0-1-1-2-2-2h-26c-1 0-2 1-2 2v147c0 1 1 2 2 2h26c1 0 2-1 2-2v-46c10 11 21 16 36 16 27 0 54-21 54-61s-27-60-54-60c-15 0-26 5-36 17zm30 78c-18 0-31-15-31-35s13-34 31-34 30 14 30 34-12 35-30 35zm68-34c0 34 27 60 62 60s62-27 62-61-26-60-61-60-63 27-63 61zm30-1c0-20 13-34 32-34s33 15 33 35-13 34-32 34-33-15-33-35zm140-58v-29c0-1 0-2-1-2h-26c-1 0-2 1-2 2v29h-13c-1 0-2 1-2 2v22c0 1 1 2 2 2h13v58c0 23 11 35 34 35 9 0 18-2 25-6 1 0 1-1 1-2v-21c0-1 0-2-1-2h-2c-5 3-11 4-16 4-8 0-12-4-12-12v-54h30c1 0 2-1 2-2v-22c0-1-1-2-2-2h-30zm129-3c0-11 4-15 13-15 5 0 10 0 15 2h1s1-1 1-2V93c0-1 0-2-1-2-5-2-12-3-22-3-24 0-36 14-36 39v5h-13c-1 0-2 1-2 2v22c0 1 1 2 2 2h13v89c0 1 1 2 2 2h26c1 0 1-1 1-2v-89h25l37 89c-4 9-8 11-14 11-5 0-10-1-15-4h-1l-1 1-9 19c0 1 0 3 1 3 9 5 17 7 27 7 19 0 30-9 39-33l45-116v-2c0-1-1-1-2-1h-27c-1 0-1 1-1 2l-28 78-30-78c0-1-1-2-2-2h-44v-3zm-83 3c-1 0-2 1-2 2v113c0 1 1 2 2 2h26c1 0 1-1 1-2V134c0-1 0-2-1-2h-26zm-6-33c0 10 9 19 19 19s18-9 18-19-8-18-18-18-19 8-19 18zm245 69c10 0 19-8 19-18s-9-18-19-18-18 8-18 18 8 18 18 18zm0-34c9 0 17 7 17 16s-8 16-17 16-16-7-16-16 7-16 16-16zm4 18c3-1 5-3 5-6 0-4-4-6-8-6h-8v19h4v-6h4l4 6h5zm-3-9c2 0 4 1 4 3s-2 3-4 3h-4v-6h4z"</span>/&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></div></pre></td></tr></table></figure><p>You can see how the multiple <code>&lt;path /&gt;</code>s have been merged into one and the values are now integers.</p><p>In this pen I have included both the original and the optimised logo:</p><p></p><p data-height="367" data-theme-id="0" data-slug-hash="BjYaKg" data-default-tab="result" data-user="jmperez" class="codepen">See the Pen <a href="http://codepen.io/jmperez/pen/BjYaKg/" target="_blank" rel="external">Optimising Spotify SVG</a> by José Manuel Pérez (<a href="http://codepen.io/jmperez" target="_blank" rel="external">@jmperez</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p><script async src="//assets.codepen.io/assets/embed/ei.js"></script>]]></content>
    
    <summary type="html">
    
      How to optimise your SVGs rounding values and using SVGOMG
    
    </summary>
    
    
      <category term="svg" scheme="https://jmperezperez.com/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title>Drawing images using edge detection and SVG animation</title>
    <link href="https://jmperezperez.com/drawing-edges-svg/"/>
    <id>https://jmperezperez.com/drawing-edges-svg/</id>
    <published>2015-12-18T08:42:00.000Z</published>
    <updated>2016-11-21T08:16:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>Back in the days SVG was barely used and supported. Some time after we started using them as an alternative to classic bitmaps for some icons, and finally we discovered it was the holy grail for providing responsive graphics. The flat and clean design trends have also make SVG as a very useful image format.</p><p>But SVG allows for even cooler features, thanks to the ability of modifying it using CSS and JS. And with some clever techniques we can make fun things, like <em>drawing</em> the borders of an image.</p><a id="more"></a><p>If you are like me and like to see the final result before going through a wall of text, here is a video that shows the result of applying this effect to a couple of images:</p><video controls style="max-width:100%" width="718" height="756"><source src="/assets/images/posts/contour.mp4" type="video/mp4"></video><h2 id="Animate-SVGs-to-achieve-a-drawing-effect"><a href="#Animate-SVGs-to-achieve-a-drawing-effect" class="headerlink" title="Animate SVGs to achieve a drawing effect"></a>Animate SVGs to achieve a <em>drawing</em> effect</h2><p>One of the applications I like is path animation. This draws slowly the lines that compose the SVG. If you don’t know what this is about, please check <a href="http://www.polygon.com/a/ps4-review" target="_blank" rel="external">Polygon’s reviews for PS4</a> and <a href="http://www.polygon.com/a/xbox-one-review" target="_blank" rel="external">Xbox One</a>. The effect is achieved by applying transitions to the <code>stroke-dashoffset</code> of SVG polylines.</p><p>Some time ago I played with <a href="https://github.com/JMPerez/spotify-logo-svg-drawing-animation" target="_blank" rel="external">this technique and the vector version of the Spotify logo</a>:</p><p></p><p data-height="403" data-theme-id="0" data-slug-hash="rxxRRg" data-default-tab="result" data-user="jmperez" class="codepen">See the Pen <a href="http://codepen.io/jmperez/pen/rxxRRg/" target="_blank" rel="external">Drawing SVGs - Spotify Logo</a> by José Manuel Pérez (<a href="http://codepen.io/jmperez" target="_blank" rel="external">@jmperez</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p><script async src="//assets.codepen.io/assets/embed/ei.js"></script><p>This was based on <a href="http://codepen.io/derekjp/pen/KIGFe/" target="_blank" rel="external">the SVG Animation (Polygon.com PS4 Review) pen by Derek Palladino</a>, who reproduced Polygon’s drawings.</p><h2 id="Applying-the-technique-to-bitmap-images"><a href="#Applying-the-technique-to-bitmap-images" class="headerlink" title="Applying the technique to bitmap images"></a>Applying the technique to bitmap images</h2><p>Then one day I started thinking of drawing the contours of bitmap images. I would detect the contours of an image using canvas, and then I would create segments of adjacent points. As expected, some smart people have already worked on these things before, and I pretty much just had to put it together.</p><p>That’s how I created Contour. The project is <a href="https://github.com/JMPerez/contour" target="_blank" rel="external">on GitHub</a>, so feel free to clone it and tweak it. And if you want to try it out right now, I have embedded it right here:</p><iframe src="https://jmperezperez.com/contour/" width="100%" height="500"></iframe><p>You can drag and drop any image. It will work better with images with areas with high contrast.</p><p>You may wonder how this works, who doesn’t?</p><h3 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h3><p>First, the image that you drop is drawn into a canvas that has a maximum size. If the image exceeds that size, it is downscaled. This allows us to process larger images without making the browser become super slow. The smallest the canvas, the fastest, but also the less accurate would be the SVG lines.</p><p>Then, there is the core process: detecting edges and creating SVG lines out of them.</p><h3 id="Canny-edge-detector"><a href="#Canny-edge-detector" class="headerlink" title="Canny edge detector"></a>Canny edge detector</h3><p>I read about the <a href="https://en.wikipedia.org/wiki/Canny_edge_detector" target="_blank" rel="external">Canny edge detector</a> trying to find an algorithm that detected the edges from an image, and then found a JS implementation. <a href="https://github.com/yuta1984/CannyJS" target="_blank" rel="external">Canny JS</a> is one of them, and performs well. However, in the end I chose <a href="https://github.com/cmisenas/canny-edge-detection" target="_blank" rel="external">Jade Misenas’s project</a> because I could visualise better the steps of the algorithm and it resulted in longer lines with fewer gaps. This is important, since we need to be able to generate SVG lines by following the pixels that are part of the edge.</p><p>By the way, if you want to learn more about edge detection, I recommend you to have a look at <a href="https://www.youtube.com/watch?v=uihBwtPIBxM" target="_blank" rel="external">the video Finding the Edges (Sobel Operator)</a>, that explains one of the operators that can be used when performing edge detection.</p><h3 id="Tracing-the-edge"><a href="#Tracing-the-edge" class="headerlink" title="Tracing the edge"></a>Tracing the edge</h3><p>To obtain the SVG lines I used <a href="https://github.com/Doodle3D/Contour-finding-experiment" target="_blank" rel="external">Doodle3D’s Contour finding experiment</a>, which I eventually simplified a bit. The idea is to traverse the canvas and, once we find a white pixel (edge), we follow the nearby pixels to compose the line.</p><p>One we have a set of lines, we create one SVG polyline per contour, using the pixels as points. There are some improvements we can do here:</p><ul><li><p>Simplify polyline to remove points that don’t contribute to the line, that is, they can fall behind a longer segment. An example is having a horizontal line spanning through several pixels, that can be defined by 2 points instead of a line with 1 point per pixel. Doing this saves potentially lots of points, especially if there are lots of vertical or horizontal lines.</p></li><li><p>Smooth the polyline to match better arcs or diagonal lines that produce a stairstep-like line. In the project this is achieved by using half of the points to draw the image. The result is not that close to the border, but helps reducing those stairstep-like lines.</p></li><li><p>Use web workers to do the detection of the contour. This would prevent the browser from freezing for a few milliseconds.</p></li></ul><h2 id="Applications"><a href="#Applications" class="headerlink" title="Applications"></a>Applications</h2><p>The effect is cool by itself and doesn’t take long to compute. The browser needs the image to create the SVG lines, but this could be stored somewhere and be served as inlined SVG or a standalone SVG file. And doing this we suddenly have found a way to start <em>rendering</em> an image without having downloaded it yet. Also, note that SVG is highly compressible and we have full control of how many lines and points we want to use to represent the image.</p><p>If you have been following this blog, I have been talking lately about techniques to load images in a progressive way, with the <a href="/medium-image-progressive-loading-placeholder/"><em>blur up</em> technique used by Medium</a> and the use of <a href="/webp-placeholder-images/">WebP as placeholders</a>.</p><p>So I see this drawing effect as not only a fun thing to do with images, but also a way to provide a <em>placeholder</em> while the final image is downloaded.</p>]]></content>
    
    <summary type="html">
    
      Using SVGs to achieve a cool drawing effect
    
    </summary>
    
    
      <category term="images" scheme="https://jmperezperez.com/tags/images/"/>
    
      <category term="ux" scheme="https://jmperezperez.com/tags/ux/"/>
    
  </entry>
  
</feed>
